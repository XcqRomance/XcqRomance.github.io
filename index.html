<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Romance的修行之路">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Romance的修行之路">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Romance的修行之路">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Romance的修行之路</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Romance的修行之路</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">分享自己学习的点滴，和大家一起学习成长</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/28/2017-12-28/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Romance">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/romance.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Romance的修行之路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/28/2017-12-28/" itemprop="url">如何使用ReactNative优雅快速开发一个属于自己的app</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-28T17:36:26+08:00">
                2017-12-28
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/28/2017-12-28/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/28/2017-12-28/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>先看整体app的效果，源码<a href="https://github.com/XcqRomance/Weather-ReactNative" target="_blank" rel="noopener">GitHub代码地址</a>，欢迎大家进行star和一起探讨。<br><img src="http://upload-images.jianshu.io/upload_images/1603505-3c85db03a22b5261.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="悦月天气" title="悦月天气"></p>
<p>本人代码的开发环境信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Mac电脑系统：Mac OS X 10.13.2</span><br><span class="line">IDE：Sublime Text，version 3.0，Build 3143</span><br><span class="line">node版本：v9.3.0</span><br><span class="line">npm版本：5.6.0</span><br><span class="line">yarn版本:  1.3.2(npm和yarn使用其中一个就行)</span><br><span class="line">react-native版本: 0.51.0</span><br><span class="line">Xcode: Version 9.2 (9C40b)</span><br><span class="line">Android Studio 3.0.1</span><br></pre></td></tr></table></figure></p>
<h2 id="一、工具篇-工欲善其事，必先利其器"><a href="#一、工具篇-工欲善其事，必先利其器" class="headerlink" title="一、工具篇-工欲善其事，必先利其器"></a>一、工具篇-工欲善其事，必先利其器</h2><p>我选择的代码编辑器是<a href="https://www.sublimetext.com/3" target="_blank" rel="noopener">Sublime Text</a>（可能需要翻墙才能访问下载，我在百度网盘分享一个链接：<a href="https://pan.baidu.com/s/1mhCy80C" target="_blank" rel="noopener">Sublime Text 3</a>，密码：bmjs），选择他来开发React Native应用的主要原因是他是<strong>免费的</strong>。但是想要高效使用Sublime开发就必须使用<strong>Sublime的插件包管理器Package Control</strong>下载几个高效开发的插件：<strong>JSX(ES6)语法高亮插件Babel</strong>、<strong>JSX代码格式化插件JsFormat</strong>、<strong>JSX语法检测插件ESLint</strong>。目前自己代码开发用到这三个就足够了。</p>
<p><strong>我发现另一个开发工具<a href="https://expo.io/tools#snack" target="_blank" rel="noopener">Expo Snack</a>很强大，直接在浏览器上写RN代码，然后实时查看效果，迅速提升开发效率，还可将app发布到Expo上面进行查看，比如react-navigation的学习demo <a href="https://expo.io/@react-navigation/NavigationPlayground" target="_blank" rel="noopener">NavigationPlayground</a>，新手可以尝试使用这个工具进行开发。</strong></p>
<ol>
<li><p><strong>安装包管理器（<a href="https://github.com/wbond/package_control" target="_blank" rel="noopener">Package Control</a>）</strong><br>Tools -&gt; Command Palette…  -&gt; 输入：Install ，然后鼠标单击Package Control选项，Sublime编辑器的左下角应该会有文字提示正在下载。查看是否下载成功：Sublime Text -&gt; Preferences 最下面有Package Control</p>
</li>
<li><p><strong>安装JSX语法高亮插件：<a href="http://babeljs.io" target="_blank" rel="noopener">Babel</a></strong><br>先看效果：<br><img src="http://upload-images.jianshu.io/upload_images/1603505-7b4685bfa8cdf5a1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="sublime安装jsx语法高亮插件前后效果对比" title="sublime安装jsx语法高亮插件前后效果对比"><br>如今，React Native使用JSX（ES6）语法开发，sublime是没法高亮的，从上图左半部分的右下角和右半部分的右下角的区别在于可以看出默认JavaScript和Javascript(Babel)，这正是js和jsx语法的区别，但是默认是没有Babel语言选项的，我们需要Package Control进行下载。<br>安装步骤：<strong>快捷键Shift+Command+P -&gt; 输入：Install Package，回车 -&gt; 输入：Babel，回车。</strong><br><img src="http://upload-images.jianshu.io/upload_images/1603505-2f3982d6b7fb2967.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="下载Babel" title="下载Babel"><br>查看是否下载成功：<code>Sublime Text -&gt; Preferences -&gt; Package Settings</code> 里面是否有Babel。<br><img src="http://upload-images.jianshu.io/upload_images/1603505-7ed319cc9f1ce92f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Babel下载成功" title="Babel下载成功"><br>切换语法为Babel，点击Sublime右下角语言这里切换为Babel，此源文件就可以高亮了。<br><img src="http://upload-images.jianshu.io/upload_images/1603505-d07a80596f7e47d1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="设置Babel" title="设置Babel"></p>
</li>
</ol>
<p><strong>我遇到一个问题是：当我关闭了项目，下次再次打开，js文件的默认语言还是JavaScript，想要高亮还得在重复上一步操作：切换语法为Babel。如果哪位有一劳永逸的设置方法，请告知下！</strong></p>
<ol>
<li><strong>安装代码格式化插件：<a href="https://github.com/jdc0589/JsFormat" target="_blank" rel="noopener">JsFormat</a></strong><br>安装、查看的步骤和2一样，使用Package Control搜索JsFormat。<br><strong>最为主要的是需要其他配置：</strong><br><strong>首先，代码格式化快捷键ctrl+option+f，为了防止与其他插件快捷键冲突，我们最好在Key Bindings - User中添加如下json</strong><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="attr">"keys"</span>: [<span class="string">"ctrl+alt+f"</span>], <span class="attr">"command"</span>: <span class="string">"js_format"</span>, <span class="attr">"context"</span>: [&#123;<span class="attr">"key"</span>: <span class="string">"selector"</span>, <span class="attr">"operator"</span>: <span class="string">"equal"</span>, <span class="attr">"operand"</span>: <span class="string">"source.js,source.json"</span>&#125;] &#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><img src="http://upload-images.jianshu.io/upload_images/1603505-0bb6cedc239f6743.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="JsFormat设置" title="JsFormat设置"><br><img src="http://upload-images.jianshu.io/upload_images/1603505-940d3547519f9e0d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="设置user keybindings file"><br><strong>其次，我们需要设置代码格式化对JSX的支持，如上图JsFormat设置 我们打开Settings-&gt;User</strong> ，并且添加如下json：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">"e4x"</span>: <span class="literal">true</span>, <span class="comment">// 支持jsx</span></span><br><span class="line">	<span class="string">"format_on_save"</span>: <span class="literal">false</span>, <span class="comment">// 保存自动代码格式化，默认也为false，可以不加</span></span><br><span class="line">	<span class="string">"brace_style"</span>: <span class="string">"collapse-preserve-inline"</span>, <span class="comment">// &#123;&#125; 不换行，加与不加的效果自己体验</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当我设置了<code>&quot;format_on_save&quot;: true</code>，我发现使用快捷键自动保存代码，触发代码格式化时有的代码会出现错乱，而且只是在ListView这部分会出现这样的情况，如下gif所示，如果哪位解决这个问题我们可以探讨下。<br><img src="http://upload-images.jianshu.io/upload_images/1603505-c64662381a91777f.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="jsFormat.gif" title="jsFormat.gif"><br>所以当我需要代码格式化时，我一般是选中需要代码格式化的部分进行代码格式化。</p>
<ol>
<li><strong>安装语法检测插件<a href="https://github.com/eslint/eslint" target="_blank" rel="noopener">ESLint</a></strong><br><strong>4.1 安装ESLint、以及ESLint插件</strong><br>我选择的是<strong>局部安装</strong>（安装在当前项目目录/node_modules/目录下），（如果全局安装则都使用全局安装，安装在/usr/local/lib/node_modules目录下），在项目根目录下依次，终端依次执行以下命令：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> npm install eslint --save-dev</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> npm install eslint-plugin-react --save-dev # ESLint支持React语义JSX的插件</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> npm install eslint-plugin-react-native # React Native 的插件</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> npm install babel-eslint #支持ES6语法的插件</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>安装的时候注意是否出现 <code>UNMET PEER DEPENDENCY</code> 字段，出现了则代表安装失败，那么可以尝试全局安装。<br><strong>4.2 配置<code>.eslintrc</code>文件</strong><br>切换到项目根目录(即包含packge.json的目录下)，执行<code>eslint --init</code><br><img src="http://upload-images.jianshu.io/upload_images/1603505-ca3111e81c81071b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="eslint选项" title="eslint选项"><br>之后在项目根目录生成了一个<code>.eslintrc.json</code>文件，并且配置如下：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"env"</span>: &#123;</span><br><span class="line">        <span class="attr">"es6"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"node"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"react-native/react-native"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"extends"</span>: [<span class="string">"eslint:recommended"</span>, <span class="string">"plugin:react/recommended"</span>,<span class="string">"plugin:react-native/all"</span>],</span><br><span class="line">    <span class="attr">"plugins"</span>: [</span><br><span class="line">        <span class="string">"react"</span>,</span><br><span class="line">        <span class="string">"react-native"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"parser"</span>: <span class="string">"babel-eslint"</span>,</span><br><span class="line">    <span class="attr">"parserOptions"</span>: &#123; </span><br><span class="line">        <span class="attr">"ecmaVersion"</span>: <span class="number">6</span>,</span><br><span class="line">        <span class="attr">"ecmaFeatures"</span>: &#123;</span><br><span class="line">            <span class="attr">"jsx"</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    "rules": &#123; // 规则，包括React Native语法的规则</span><br><span class="line">        "class-methods-use-this": 0,</span><br><span class="line">        "react-native/no-color-literals": 0,</span><br><span class="line">        "react-native/no-unused-styles": 0,</span><br><span class="line">        "react-native/no-inline-styles": 0,</span><br><span class="line">        "react-native/split-platform-components": 2,</span><br><span class="line">        "no-unused-vars": 0,</span><br><span class="line">        "no-use-before-define": 0,</span><br><span class="line">        "no-console": 0,</span><br><span class="line">        "react/prop-types": 0,</span><br><span class="line">        "react/no-direct-mutation-state": 0</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>想要更详细的配置可以查看下官网的<a href="https://eslint.org/docs/user-guide/configuring" target="_blank" rel="noopener">Configuring ESLint</a>。<br><strong>4.3 安装Sublime插件SublimeLinter、SublimeLinter-contrib-eslint</strong><br>使用package control进行安装，然后配置setting-user文件如下：<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"user"</span>: &#123;</span><br><span class="line">        <span class="attr">"debug"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"delay"</span>: <span class="number">0.25</span>,</span><br><span class="line">        <span class="attr">"error_color"</span>: <span class="string">"D02000"</span>,</span><br><span class="line">        <span class="attr">"gutter_theme"</span>: <span class="string">"Packages/SublimeLinter/gutter-themes/Default/Default.gutter-theme"</span>,</span><br><span class="line">        <span class="attr">"gutter_theme_excludes"</span>: [],</span><br><span class="line">        <span class="attr">"lint_mode"</span>: <span class="string">"background"</span>,</span><br><span class="line">        <span class="attr">"linters"</span>: &#123;</span><br><span class="line">            <span class="attr">"eslint"</span>: &#123;</span><br><span class="line">                <span class="attr">"@disable"</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="attr">"args"</span>: [],</span><br><span class="line">                <span class="attr">"excludes"</span>: []</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"jsxhint"</span>: &#123;</span><br><span class="line">                <span class="attr">"@disable"</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="attr">"args"</span>: [],</span><br><span class="line">                <span class="attr">"excludes"</span>: []</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"mark_style"</span>: <span class="string">"outline"</span>,</span><br><span class="line">        <span class="attr">"no_column_highlights_line"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"passive_warnings"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"paths"</span>: &#123;</span><br><span class="line">            <span class="attr">"linux"</span>: [],</span><br><span class="line">            <span class="attr">"osx"</span>: [],</span><br><span class="line">            <span class="attr">"windows"</span>: []</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"python_paths"</span>: &#123;</span><br><span class="line">            <span class="attr">"linux"</span>: [],</span><br><span class="line">            <span class="attr">"osx"</span>: [],</span><br><span class="line">            <span class="attr">"windows"</span>: []</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"rc_search_limit"</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="attr">"shell_timeout"</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="attr">"show_errors_on_save"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"show_marks_in_minimap"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"syntax_map"</span>: &#123;</span><br><span class="line">            <span class="attr">"html (django)"</span>: <span class="string">"html"</span>,</span><br><span class="line">            <span class="attr">"html (rails)"</span>: <span class="string">"html"</span>,</span><br><span class="line">            <span class="attr">"html 5"</span>: <span class="string">"html"</span>,</span><br><span class="line">            <span class="attr">"javascript (babel)"</span>: <span class="string">"javascript"</span>,</span><br><span class="line">            <span class="attr">"magicpython"</span>: <span class="string">"python"</span>,</span><br><span class="line">            <span class="attr">"php"</span>: <span class="string">"html"</span>,</span><br><span class="line">            <span class="attr">"python django"</span>: <span class="string">"python"</span>,</span><br><span class="line">            <span class="attr">"pythonimproved"</span>: <span class="string">"python"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"tooltip_fontsize"</span>: <span class="string">"1rem"</span>,</span><br><span class="line">        <span class="attr">"tooltip_theme"</span>: <span class="string">"Packages/SublimeLinter/tooltip-themes/Default/Default.tooltip-theme"</span>,</span><br><span class="line">        <span class="attr">"tooltip_theme_excludes"</span>: [],</span><br><span class="line">        <span class="attr">"tooltips"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"use_current_shell_path"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"warning_color"</span>: <span class="string">"DDB700"</span>,</span><br><span class="line">        <span class="attr">"wrap_find"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1603505-5ba86db405656bd1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="settings-user" title="settings-user"><br>效果如下：<br><img src="http://upload-images.jianshu.io/upload_images/1603505-7b7bdfe84c5af893.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="静态语法检测效果"></p>
<h2 id="二、代码篇"><a href="#二、代码篇" class="headerlink" title="二、代码篇"></a>二、代码篇</h2><p><strong>悦月天气这个app比较简单（<a href="https://github.com/XcqRomance/Weather-ReactNative" target="_blank" rel="noopener">GitHub代码地址</a>），主要有两部分：城市天气展示界面，选择城市界面。</strong>首页的天气预报的接口使用的是和风天气免费的每天1000次访问的API，城市列表数据使用的郭霖的第一行代码的接口。下面是一套RN代码分别在iPhone6模拟器和android模拟器的效果，<strong>代码复用率几乎为100%</strong>。<br><img src="http://upload-images.jianshu.io/upload_images/1603505-e9f2ddf9991126f1.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="android_weather.gif" title="android_weather.gif"><br><img src="http://upload-images.jianshu.io/upload_images/1603505-3c85db03a22b5261.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ios_weather.gif" title="ios_weather.gif"></p>
<p>开发这个app花费我总共一周的时间，包括去学习RN最基本的 <code>JSX语法、组件、state状态以及props</code>，到现在全部完成整个app，到目前为止，我也只能算是懂一点皮毛，至于要更加深入的理解、使用，则需要更多的实践和学习，所以这代码部分我更多的是以一个初学者的身份来怎么快速进行编码和解决问题。至于学习教程我建议使用<a href="http://facebook.github.io/react-native/" target="_blank" rel="noopener">React Native官网的资料</a>，而不是<a href="http://reactnative.cn" target="_blank" rel="noopener">React Native 中文网</a>，但是这个就需要一点英语基础了，遇到实在不懂的，完全可以使用翻译工具解决，看原始英文文档的好处是可以接触最新的技术，同时提升自己的英语水平。比如下面要提及的比如<br><code>create-react-native-app、Expo</code>等等技术。</p>
<ol>
<li>创建项目：<a href="https://github.com/react-community/create-react-native-app" target="_blank" rel="noopener">create-react-native-app</a><br>我使用的是终端命令：<code>create-react-native-app DailyWeather</code>而不是<code>react-native init DailyWeather</code>来创建的项目。这二者最大的区别就是，前者没有嵌入式，直接npm start或者yarn start就能运行项目，再结合<a href="https://expo.io/tools#client" target="_blank" rel="noopener">Expo app</a>就能在模拟器实时查看运行效果，没有ios和android这两个文件目录，一个纯js项目，不能通过Xcode或者Android Studio开发工具打开项目进行配置。由于我这个app的icon图标和启动图片是使用原生配置，所以需要执行<code>npm run eject</code>或<code>yarn run eject</code>命令，生成这两个ios和android目录，然后通过配置Xcode和Android Studio来配置icon图标和启动页。<br><img src="http://upload-images.jianshu.io/upload_images/1603505-dae01f5ebd637270.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="create-react-native-app DailyWeather项目目录" title="create-react-native-app DailyWeather项目目录"><br><img src="http://upload-images.jianshu.io/upload_images/1603505-aae7d50be1a5db7f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="react-native init DailyWeather 以及 yarn run eject后项目目录" title="react-native init DailyWeather 以及 yarn run eject后项目目录"></li>
<li><p>运行项目<br>在项目目录执行<code>yarn run eject</code>之前（也就是有ios和android两个工程项目目录之前），我是直接执行<code>yarn start</code>启动一个开发服务器，然后在模拟器或者手机上使用Expo app 打开悦月天气app进行开发调试；之后我就直接通过Xcode和Android Studio分别打开项目然后运行在模拟器上，运行之前得先将<code>AppDelegate.m</code>的第21行代码<code>jsCodeLocation = [[RCTBundleURLProvider sharedSettings] jsBundleURLForBundleRoot:@&quot;index&quot; fallbackResource:nil];</code>改为<code>jsCodeLocation = [NSURL URLWithString:@&quot;http://127.0.0.1:8081/index.bundle?platform=ios&amp;dev=true&quot;];</code>否则运行将报错：<br><img src="http://upload-images.jianshu.io/upload_images/1603505-79c01b39ee1a9797.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
</li>
<li><p>首页代码编写<br><img src="http://upload-images.jianshu.io/upload_images/1603505-11ea750b4fdd3b6a.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeScreen</span> <span class="keyword">extends</span> <span class="title">Component</span> &lt; </span>&#123;&#125; &gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//组件的构造方法，在组建创建的时候调用</span></span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">var</span> ds = <span class="keyword">new</span> ListView.DataSource(&#123;</span><br><span class="line">      rowHasChanged: <span class="function">(<span class="params">r1, r2</span>) =&gt;</span> r1 !== r2</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      isLoading: <span class="literal">true</span>,</span><br><span class="line">      quiltyColor: <span class="literal">true</span>,</span><br><span class="line">      refreshing: <span class="literal">false</span>,</span><br><span class="line">      dataSource: ds,</span><br><span class="line">      suggegstions: &#123;&#125;, <span class="comment">// 代表一个空json,生活建议</span></span><br><span class="line">      aqi: &#123;&#125;, <span class="comment">// aqi</span></span><br><span class="line">      basic: &#123;&#125;,</span><br><span class="line">      title: <span class="string">'海淀'</span> <span class="comment">// 默认获取海淀区的天气</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 页面的渲染</span></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state.isLoading) &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;View style=&#123;&#123;<span class="attr">flex</span>: <span class="number">1</span>, <span class="attr">justifyContent</span>: <span class="string">'center'</span>, <span class="attr">alignItems</span>: <span class="string">'center'</span>&#125;&#125;&gt;</span><br><span class="line">          &lt;ActivityIndicator/&gt;</span><br><span class="line">        &lt;<span class="regexp">/View&gt;</span></span><br><span class="line"><span class="regexp">      )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    return (</span></span><br><span class="line"><span class="regexp">      &lt;View style=&#123;&#123;flex: 1&#125;&#125;&gt;</span></span><br><span class="line"><span class="regexp">        &#123;/</span>*北京图*<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">        &lt;ImageBackground source=&#123;&#123;uri: 'http:/</span><span class="regexp">/cn.bing.com/</span>az/hprichbg/rb/BarHarborCave_ROW9345444229_1920x1080.jpg<span class="string">'&#125;&#125;  style=&#123;&#123;width: screenWidth, height: screenHeight&#125;&#125;&gt;</span></span><br><span class="line"><span class="string">          &lt;ScrollView style = &#123;&#123;flex: 1&#125;&#125; </span></span><br><span class="line"><span class="string">            refreshControl=&#123;</span></span><br><span class="line"><span class="string">              &lt;RefreshControl refreshing=&#123;this.state.refreshing&#125; onRefresh=&#123;this._onRefresh.bind(this)&#125;/&gt;</span></span><br><span class="line"><span class="string">            &#125;&gt;</span></span><br><span class="line"><span class="string">            &#123;/*渲染头部信息*/&#125;</span></span><br><span class="line"><span class="string">            &#123;this.reanderHeader()&#125;</span></span><br><span class="line"><span class="string">            &#123;/*渲染天气预报列表*/&#125;</span></span><br><span class="line"><span class="string">            &#123;this.reanderForecast()&#125;</span></span><br><span class="line"><span class="string">            &#123;/*渲染天气质量*/&#125;</span></span><br><span class="line"><span class="string">            &#123;this.renderAirquilty()&#125;</span></span><br><span class="line"><span class="string">            &#123;/*渲染生活指数*/&#125;</span></span><br><span class="line"><span class="string">            &#123;this.renderSuggestion()&#125;</span></span><br><span class="line"><span class="string">          &lt;/ScrollView&gt; </span></span><br><span class="line"><span class="string">        &lt;/ImageBackground&gt;</span></span><br><span class="line"><span class="string">      &lt;/View&gt;</span></span><br><span class="line"><span class="string">    );</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  _onRefresh() &#123;</span></span><br><span class="line"><span class="string">    this.setupData(this.state.title);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  // 组件已经装载，绘制完毕调用</span></span><br><span class="line"><span class="string">  componentDidMount() &#123;</span></span><br><span class="line"><span class="string">    console.log(screenWidth)</span></span><br><span class="line"><span class="string">    console.log(screenHeight)</span></span><br><span class="line"><span class="string">    this.setupData(this.state.title);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  // 组件即将卸载，组件要被从界面上移除时调用</span></span><br><span class="line"><span class="string">  componentWillUnmount() &#123;</span></span><br><span class="line"><span class="string">    console.log('</span>HomeScreen<span class="string">','</span>componentWillUnmount<span class="string">')</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  setupData(cityname) &#123;</span></span><br><span class="line"><span class="string">    // cityid可以使用cityid 也可以使用 城市名，选择城市回调回来</span></span><br><span class="line"><span class="string">    let urlstr = '</span>http:<span class="comment">//guolin.tech/api/weather?key=41dd96cb90344217acbf5fe0813f16cd' + '&amp;cityid=' + cityname</span></span><br><span class="line">    <span class="built_in">console</span>.log(urlstr)</span><br><span class="line">    fetch(urlstr)</span><br><span class="line">      .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">      .then(<span class="function">(<span class="params">responseJson</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'success1'</span>, responseJson);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'success2'</span>, responseJson.HeWeather[<span class="number">0</span>].daily_forecast);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'success3'</span>, responseJson.HeWeather[<span class="number">0</span>].suggestion);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">          refreshing: <span class="literal">false</span>,</span><br><span class="line">          isLoading: <span class="literal">false</span>,</span><br><span class="line">          dataSource: <span class="keyword">this</span>.state.dataSource.cloneWithRows(responseJson.HeWeather[<span class="number">0</span>].daily_forecast),</span><br><span class="line">          suggegstions: responseJson.HeWeather[<span class="number">0</span>].suggestion,</span><br><span class="line">          aqi: responseJson.HeWeather[<span class="number">0</span>].aqi,</span><br><span class="line">          title: responseJson.HeWeather[<span class="number">0</span>].basic.city,</span><br><span class="line">          des: responseJson.HeWeather[<span class="number">0</span>].now.cond.txt,</span><br><span class="line">          temp: responseJson.HeWeather[<span class="number">0</span>].now.tmp,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(error);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  reanderHeader() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;View style=&#123;styles.header&#125;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;View style=&#123;&#123;<span class="attr">flexDirection</span>: <span class="string">'row'</span>, <span class="attr">alignItems</span>: <span class="string">'center'</span> ,<span class="attr">marginTop</span>: <span class="number">44</span>, <span class="attr">marginBottom</span>: <span class="number">10</span>&#125;&#125;&gt;</span><br><span class="line">              &lt;Text style=&#123;styles.headerTitle&#125;&gt;&#123;<span class="keyword">this</span>.state.title&#125;&lt;<span class="regexp">/Text&gt;</span></span><br><span class="line"><span class="regexp">              &lt;TouchableOpacity onPress=&#123;() =&gt; this.props.navigation.navigate('City',&#123;name: this.state.title, currentLevel: 0, callBack: (data) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">                  console.log(data) /</span><span class="regexp">/ weather_id</span></span><br><span class="line"><span class="regexp">                  this.setupData(data);</span></span><br><span class="line"><span class="regexp">                &#125;&#125;)&#125;&gt;</span></span><br><span class="line"><span class="regexp">                &lt;Image source=&#123;require('./</span>address.png<span class="string">')&#125;/&gt;</span></span><br><span class="line"><span class="string">              &lt;/TouchableOpacity&gt;</span></span><br><span class="line"><span class="string">            &lt;/View&gt;</span></span><br><span class="line"><span class="string">            &lt;Text style=&#123;styles.headerDes&#125;&gt;&#123;this.state.des&#125;&lt;/Text&gt;</span></span><br><span class="line"><span class="string">            &lt;Text style=&#123;styles.headerTepe&#125;&gt;&#123;this.state.temp&#125;℃&lt;/Text&gt;</span></span><br><span class="line"><span class="string">      &lt;/View&gt;</span></span><br><span class="line"><span class="string">    );</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  reanderForecast() &#123;</span></span><br><span class="line"><span class="string">    return (</span></span><br><span class="line"><span class="string">      &lt;View style=&#123;styles.forecast&#125;&gt;</span></span><br><span class="line"><span class="string">            &lt;Text style=&#123;&#123;color: '</span>white<span class="string">', fontSize: 20, marginBottom: 10&#125;&#125;&gt;预报&lt;/Text&gt;</span></span><br><span class="line"><span class="string">            &lt;ListView </span></span><br><span class="line"><span class="string">              dataSource=&#123;this.state.dataSource&#125;</span></span><br><span class="line"><span class="string">              renderRow=&#123;(rowData) =&gt;  (</span></span><br><span class="line"><span class="string">                &lt;View style=&#123;styles.listView&#125;&gt;</span></span><br><span class="line"><span class="string">                  &lt;Text style=&#123;&#123;color: '</span>white<span class="string">',flex: 1&#125;&#125;&gt;&#123;rowData.date&#125;&lt;/Text&gt;</span></span><br><span class="line"><span class="string">                  &lt;Text style=&#123;&#123;color: '</span>white<span class="string">',flex: 1&#125;&#125;&gt;&#123;rowData.cond.txt_d&#125;&lt;/Text&gt;</span></span><br><span class="line"><span class="string">                  &lt;Text style=&#123;&#123;color: '</span>white<span class="string">',flex: 1&#125;&#125;&gt;&#123;rowData.tmp.max&#125;&lt;/Text&gt;</span></span><br><span class="line"><span class="string">                  &lt;Text style=&#123;&#123;color: '</span>white<span class="string">',flex: 1&#125;&#125;&gt;&#123;rowData.tmp.min&#125;&lt;/Text&gt;</span></span><br><span class="line"><span class="string">                &lt;/View&gt;</span></span><br><span class="line"><span class="string">              )&#125;/&gt; </span></span><br><span class="line"><span class="string">      &lt;/View&gt;</span></span><br><span class="line"><span class="string">    );</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  renderAirquilty() &#123;</span></span><br><span class="line"><span class="string">    let &#123;</span></span><br><span class="line"><span class="string">      aqi</span></span><br><span class="line"><span class="string">    &#125; = this.state;</span></span><br><span class="line"><span class="string">    return (</span></span><br><span class="line"><span class="string">      &lt;View&gt;</span></span><br><span class="line"><span class="string">          &lt;View style=&#123;styles.suggestion&#125;&gt;</span></span><br><span class="line"><span class="string">            &lt;View style=&#123;&#123;flexDirection: '</span>row<span class="string">',justifyContent: '</span>flex-start<span class="string">', alignItems: '</span>center<span class="string">',padding: 20&#125;&#125;&gt;</span></span><br><span class="line"><span class="string">              &lt;Text style=&#123;&#123;color: '</span>white<span class="string">',fontSize: 20&#125;&#125;&gt;空气质量：&lt;/Text&gt;</span></span><br><span class="line"><span class="string">              &lt;Text style=&#123;&#123;color: '</span>red<span class="string">',fontSize: 17&#125;&#125;&gt;&#123;aqi.city.qlty&#125;&lt;/Text&gt;</span></span><br><span class="line"><span class="string">            &lt;/View&gt;</span></span><br><span class="line"><span class="string">            &lt;View style=&#123;&#123;flex: 1,flexDirection: '</span>row<span class="string">'&#125;&#125;&gt;</span></span><br><span class="line"><span class="string">              &lt;View style=&#123;&#123;flex: 1, alignItems: '</span>center<span class="string">' &#125;&#125;&gt;</span></span><br><span class="line"><span class="string">                &lt;Text style=&#123;styles.airQuiltyDes&#125;&gt;AQI指数&lt;/Text&gt;</span></span><br><span class="line"><span class="string">                &lt;Text style=&#123;styles.airQuiltyValue&#125;&gt;&#123;aqi.city.aqi&#125;&lt;/Text&gt;</span></span><br><span class="line"><span class="string">              &lt;/View&gt;</span></span><br><span class="line"><span class="string">              &lt;View style=&#123;&#123;flex: 1, alignItems: '</span>center<span class="string">' &#125;&#125;&gt;</span></span><br><span class="line"><span class="string">                &lt;Text style=&#123;styles.airQuiltyDes&#125;&gt;PM2.5&lt;/Text&gt;</span></span><br><span class="line"><span class="string">                &lt;Text style=&#123;styles.airQuiltyValue&#125;&gt;&#123;aqi.city.pm25&#125;&lt;/Text&gt;</span></span><br><span class="line"><span class="string">              &lt;/View&gt;</span></span><br><span class="line"><span class="string">            &lt;/View&gt;</span></span><br><span class="line"><span class="string">            &lt;View style=&#123;&#123;flex: 1,flexDirection: '</span>row<span class="string">'&#125;&#125;&gt;</span></span><br><span class="line"><span class="string">              &lt;View style=&#123;&#123;flex: 1,alignItems: '</span>center<span class="string">' &#125;&#125;&gt;</span></span><br><span class="line"><span class="string">                &lt;Text style=&#123;styles.airQuiltyDes&#125;&gt;PM10&lt;/Text&gt;</span></span><br><span class="line"><span class="string">                &lt;Text style=&#123;styles.airQuiltyValue&#125;&gt;&#123;aqi.city.pm10&#125;&lt;/Text&gt;</span></span><br><span class="line"><span class="string">              &lt;/View&gt;</span></span><br><span class="line"><span class="string">              &lt;View style=&#123;&#123;flex: 1, alignItems: '</span>center<span class="string">' &#125;&#125;&gt;</span></span><br><span class="line"><span class="string">                &lt;Text style=&#123;styles.airQuiltyDes&#125;&gt;O3指数&lt;/Text&gt;</span></span><br><span class="line"><span class="string">                &lt;Text style=&#123;styles.airQuiltyValue&#125;&gt;&#123;aqi.city.o3&#125;&lt;/Text&gt;</span></span><br><span class="line"><span class="string">              &lt;/View&gt;</span></span><br><span class="line"><span class="string">            &lt;/View&gt;</span></span><br><span class="line"><span class="string">          &lt;/View&gt;</span></span><br><span class="line"><span class="string">        &lt;/View&gt;</span></span><br><span class="line"><span class="string">    )</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  renderSuggestion() &#123;</span></span><br><span class="line"><span class="string">    let &#123;</span></span><br><span class="line"><span class="string">      suggegstions</span></span><br><span class="line"><span class="string">    &#125; = this.state;</span></span><br><span class="line"><span class="string">    return (</span></span><br><span class="line"><span class="string">      &lt;View style=&#123;styles.suggestion&#125;&gt;</span></span><br><span class="line"><span class="string">          &lt;Text style=&#123;&#123;color: '</span>white<span class="string">',fontSize: 20,marginBottom: 20,marginTop: 20,marginLeft: 20&#125;&#125;&gt;生活建议&lt;/Text&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">          &lt;Text style=&#123;styles.suggestionDes&#125;&gt;空气质量：&#123;suggegstions.air.txt&#125;&lt;/Text&gt;</span></span><br><span class="line"><span class="string">          &lt;Text style=&#123;styles.suggestionDes&#125;&gt;舒适度：&#123;suggegstions.comf.txt&#125;&lt;/Text&gt;</span></span><br><span class="line"><span class="string">          &lt;Text style=&#123;styles.suggestionDes&#125;&gt;洗车：&#123;suggegstions.cw.txt&#125;&lt;/Text&gt;</span></span><br><span class="line"><span class="string">          &lt;Text style=&#123;styles.suggestionDes&#125;&gt;穿衣：&#123;suggegstions.drsg.txt&#125;&lt;/Text&gt;</span></span><br><span class="line"><span class="string">          &lt;Text style=&#123;styles.suggestionDes&#125;&gt;感冒：&#123;suggegstions.flu.txt&#125;&lt;/Text&gt;</span></span><br><span class="line"><span class="string">          &lt;Text style=&#123;styles.suggestionDes&#125;&gt;运动：&#123;suggegstions.sport.txt&#125;&lt;/Text&gt;</span></span><br><span class="line"><span class="string">          &lt;Text style=&#123;styles.suggestionDes&#125;&gt;旅游：&#123;suggegstions.trav.txt&#125;&lt;/Text&gt;</span></span><br><span class="line"><span class="string">          &lt;Text style=&#123;styles.suggestionDes&#125;&gt;紫外线：&#123;suggegstions.uv.txt&#125;&lt;/Text&gt;</span></span><br><span class="line"><span class="string">        &lt;/View&gt;</span></span><br><span class="line"><span class="string">    );</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>我们主要看<code>render()</code>方法，这个方法主要进行页面的渲染。说实话，刚开始使用Flexbox布局时还真别扭（使用iOS布局技术AutoLayout久了），最后按照使用Flexbox倒腾了几个 demo，也就慢慢会了基本布局。背景图使用的是<a href="https://github.com/facebook/react-native/tree/9637dd4a1b78d5f6da510b1b4ad10d45d67badbf/Libraries/Image" target="_blank" rel="noopener">ImageBackground组件</a>，首页信息显示使用的是<a href="http://facebook.github.io/react-native/docs/scrollview.html" target="_blank" rel="noopener">ScrollView组件</a>，三天的预报使用的<a href="http://facebook.github.io/react-native/docs/listview.html" target="_blank" rel="noopener">ListView组件</a>，其他的就是其他组件嵌套布局起来的。<strong>这里遇到过的两个阻碍，一是页面背景原先使用Image组件，但是发现他不能够嵌套其他元素；其次就是页面路由，使用的react-navigation的StackNavigator，在这里花费了两天学习，包括他的 <a href="https://github.com/react-navigation/react-navigation" target="_blank" rel="noopener">官方demo</a> <a href="https://expo.io/@react-navigation/NavigationPlayground" target="_blank" rel="noopener">NavigationPlayground</a>（得先下载<a href="https://expo.io/tools#client" target="_blank" rel="noopener">Expo app</a>进行扫面二维码打开）</strong>；</p>
<ol>
<li>城市列表代码编写<br><img src="http://upload-images.jianshu.io/upload_images/1603505-08b9360366dcfd7e.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CityScreen</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> navigationOptions = <span class="function">(<span class="params">&#123;navigation&#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">    headerMode: <span class="string">'float'</span>,</span><br><span class="line">    gesturesEnabled: <span class="literal">true</span>,</span><br><span class="line">    headerTitle: <span class="string">`<span class="subst">$&#123;navigation.state.params.name&#125;</span>`</span>,</span><br><span class="line">    headerLeft:  (</span><br><span class="line">      &lt;TouchableOpacity onPress=&#123;() =&gt; &#123;</span><br><span class="line">          navigation.goBack(<span class="literal">null</span>)        </span><br><span class="line">      &#125;&#125;&gt;</span><br><span class="line">        &lt;Image source=&#123;<span class="built_in">require</span>(<span class="string">'./moments_btn_back.png'</span>)&#125; style=&#123;&#123;<span class="attr">marginLeft</span>: <span class="number">8</span>&#125;&#125;/&gt;    </span><br><span class="line">      &lt;<span class="regexp">/TouchableOpacity&gt;</span></span><br><span class="line"><span class="regexp">      ),</span></span><br><span class="line"><span class="regexp">    headerStyle: &#123;</span></span><br><span class="line"><span class="regexp">      backgroundColor: '#6666ff',</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    headerTintColor: 'white',</span></span><br><span class="line"><span class="regexp">    headerTitleStyle: &#123;</span></span><br><span class="line"><span class="regexp">      fontSize: 20</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  constructor(props) &#123;</span></span><br><span class="line"><span class="regexp">    super(props);</span></span><br><span class="line"><span class="regexp">  </span></span><br><span class="line"><span class="regexp">    this.state = &#123;</span></span><br><span class="line"><span class="regexp">      loading: true,</span></span><br><span class="line"><span class="regexp">      currentLevel: 0, /</span><span class="regexp">/ 0:province, 1:city, 2:county;</span></span><br><span class="line"><span class="regexp">      provinces: [&#123;&#125;],</span></span><br><span class="line"><span class="regexp">      provinceData: &#123;&#125;,</span></span><br><span class="line"><span class="regexp">      cityData: &#123;&#125;</span></span><br><span class="line"><span class="regexp">    &#125;;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  render() &#123;</span></span><br><span class="line"><span class="regexp">    const &#123; navigation &#125; = this.props;</span></span><br><span class="line"><span class="regexp">    const &#123; state, setParams, goBack &#125; = navigation;</span></span><br><span class="line"><span class="regexp">    const &#123; params, currentLevel &#125; = state;</span></span><br><span class="line"><span class="regexp">    if (this.state.loading) &#123;</span></span><br><span class="line"><span class="regexp">      return  (&lt;View style=&#123;&#123;flex: 1, justifyContent: 'center', alignItems: 'center'&#125;&#125;&gt;</span></span><br><span class="line"><span class="regexp">        &lt;ActivityIndicator/</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/View&gt;)</span></span><br><span class="line"><span class="regexp">    &#125; </span></span><br><span class="line"><span class="regexp">    return (</span></span><br><span class="line"><span class="regexp">        &lt;FlatList style=&#123;&#123;backgroundColor: 'white'&#125;&#125;</span></span><br><span class="line"><span class="regexp">          data=&#123;this.state.provinces&#125;</span></span><br><span class="line"><span class="regexp">          renderItem=&#123;(&#123;item&#125;) =&gt; &#123; </span></span><br><span class="line"><span class="regexp">            return (</span></span><br><span class="line"><span class="regexp">              &lt;TouchableOpacity </span></span><br><span class="line"><span class="regexp">                  style=&#123;&#123;justifyContent: 'center', alignItems: 'center',height: 44&#125;&#125;</span></span><br><span class="line"><span class="regexp">                  onPress=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">                    setParams(&#123;name: item.name&#125;)</span></span><br><span class="line"><span class="regexp">                    let level = this.state.currentLevel</span></span><br><span class="line"><span class="regexp">                    if (this.state.currentLevel === 0) &#123;</span></span><br><span class="line"><span class="regexp">                      this.state.provinceData = item</span></span><br><span class="line"><span class="regexp">                    &#125; else if (this.state.currentLevel === 1) &#123;</span></span><br><span class="line"><span class="regexp">                      this.state.cityData = item</span></span><br><span class="line"><span class="regexp">                    &#125;</span></span><br><span class="line"><span class="regexp">                    if (this.state.currentLevel === 2) &#123;</span></span><br><span class="line"><span class="regexp">                      console.log("goBack")</span></span><br><span class="line"><span class="regexp">                      state.params.callBack(item.weather_id) /</span><span class="regexp">/ 回调</span></span><br><span class="line"><span class="regexp">                      goBack(null)</span></span><br><span class="line"><span class="regexp">                    &#125; else &#123;</span></span><br><span class="line"><span class="regexp">                      this.state.currentLevel = level + 1</span></span><br><span class="line"><span class="regexp">                      setParams(&#123;currentLevel: level + 1&#125;)</span></span><br><span class="line"><span class="regexp">                      console.log(this.state.currentLevel)</span></span><br><span class="line"><span class="regexp">                      /</span><span class="regexp">/ console.log(this.state.provinceData )</span></span><br><span class="line"><span class="regexp">                      this.state.loading = true </span></span><br><span class="line"><span class="regexp">                      this.setupData(this.state.currentLevel)</span></span><br><span class="line"><span class="regexp">                    &#125;</span></span><br><span class="line"><span class="regexp">                  &#125;&#125;&gt;</span></span><br><span class="line"><span class="regexp">                  &lt;Text style=&#123;&#123; color: 'gray', fontSize: 20&#125;&#125; &gt;&#123;item.name&#125; &lt;/</span>Text&gt;   </span><br><span class="line">              &lt;<span class="regexp">/TouchableOpacity&gt;</span></span><br><span class="line"><span class="regexp">             </span></span><br><span class="line"><span class="regexp">            )&#125; &#125;</span></span><br><span class="line"><span class="regexp">          ItemSeparatorComponent=&#123; () =&gt; &#123; return (</span></span><br><span class="line"><span class="regexp">            &lt;View style=&#123;&#123;height: 1, backgroundColor: '#eee'&#125;&#125;/</span>&gt; <span class="comment">//&lt;/View&gt;</span></span><br><span class="line">            )&#125;&#125;</span><br><span class="line">          keyExtractor=&#123;</span><br><span class="line">            (item, index) =&gt; item.id</span><br><span class="line">          &#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.setupData(<span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setupData(level) &#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">var</span> urlstr = <span class="string">''</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (level == <span class="number">0</span>) &#123;</span><br><span class="line">      urlstr = <span class="string">'http://guolin.tech/api/china'</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (level == <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> provinceData = <span class="keyword">this</span>.state.provinceData</span><br><span class="line">      <span class="built_in">console</span>.log(provinceData)</span><br><span class="line">      urlstr = <span class="string">'http://guolin.tech/api/china/'</span> + <span class="string">`<span class="subst">$&#123;provinceData.id&#125;</span>`</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (level == <span class="number">2</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> provinceData = <span class="keyword">this</span>.state.provinceData</span><br><span class="line">      <span class="keyword">let</span> cityData = <span class="keyword">this</span>.state.cityData</span><br><span class="line">      urlstr = <span class="string">'http://guolin.tech/api/china/'</span> + <span class="string">`<span class="subst">$&#123;provinceData.id&#125;</span>`</span> + <span class="string">'/'</span> + <span class="string">`<span class="subst">$&#123;cityData.id&#125;</span>`</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(urlstr)</span><br><span class="line">    fetch(urlstr)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">    .then(<span class="function">(<span class="params">responseJson</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(responseJson)</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        loading: <span class="literal">false</span>,</span><br><span class="line">        provinces: responseJson,</span><br><span class="line">        currentLevel: level,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(error);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>列表我是用的是<a href="http://facebook.github.io/react-native/docs/using-a-listview.html" target="_blank" rel="noopener">FlatList组件</a>，这个页面遇到的阻碍有两个，一是点击item更换navigation的headertitle；二是最后的点击城市回调数据给首页同时更新首页数据。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><strong>你可能会说这个app很简单，的确他很简单（比如没有地图，没有数据持久化等等，未来说不定就有了），只是一个简单的界面展示。但是只有当你真正实践去开发一个属于你的app时，你会发现其实过程没有你想的简单；但是当你完成时，你就会感觉小有成就，特别是能够分享出去，让更多的人看到。</strong>前两天看到池建强老师的2018技术趋势预测，移动开发学点js也很不错。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/18/2017-12-18/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Romance">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/romance.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Romance的修行之路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/18/2017-12-18/" itemprop="url">优雅快速的搭建iOS工程框架搭建的探讨</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-18T21:02:19+08:00">
                2017-12-18
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/18/2017-12-18/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/18/2017-12-18/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>一个简洁优雅的iOS工程目录，能够帮助团队提升开发效率，同时也令自己进行心情愉悦的编码；反之，杂乱无章的目录则会使人心情烦躁，降低团队开发效率。</p>
</blockquote>
<p>不知你是否也有同感？欢迎你在评论区写下的感受。</p>
<hr>
<h2 id="首先，我想说："><a href="#首先，我想说：" class="headerlink" title="首先，我想说："></a>首先，我想说：</h2><ul>
<li>本文说的工程架构适用于纯代码开发的团队，也适用于使用Storyboard开发的团队；</li>
<li>本文适用于传统的Tabbar+NavigationBar搭建的app，也适用于其他非传统的app；</li>
<li><strong>本文特别适用于让团队的新进成员了解项目的整体构架，并且进行快速开发</strong></li>
</ul>
<h2 id="本文以公司的FCS-app为例，界面如下："><a href="#本文以公司的FCS-app为例，界面如下：" class="headerlink" title="本文以公司的FCS app为例，界面如下："></a>本文以公司的FCS app为例，界面如下：</h2><p><img src="http://upload-images.jianshu.io/upload_images/1603505-0db44cd031797d95.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="主界面"><br>公司的项目属于Objective-C和Swift混编的项目，对于纯swift的项目和纯OC的项目，可能文件夹和类文需要自行修改，Xcode项目工程目录如下：<img src="http://upload-images.jianshu.io/upload_images/1603505-461601d95aa1cb3e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="工程框架搭建图"><br>正如上图所示，我将项目划分为9大部分，<a href="https://github.com/XcqRomance/FastProjectFramework" target="_blank" rel="noopener">GitHub地址</a>：</p>
<blockquote>
<p><strong>Models</strong>：模型数据类，所有自定义的数据模型应该放在此处；<br><strong>Views</strong>：视图类，以功能模块还需要再建一层文件夹，所有自定义的功能模块的视图类都应该放在给自的文件夹下此处，，手动拖入的第三方UI控件除外，第三方的UI应该放入Vendor文件夹里；<br><strong>Controllers</strong>：控制器类，所有控制器类放在此文件夹里面，如果有<code>BaseViewController、BaseNavigationController</code>可以放在Base文件夹下（可以在此目录下新建的一个Base文件夹），同时相应功能模块的Storyboard也放在此目录下，Storyboard放在此处相比于放在View里面更加方便（我们项目最开始在Views目录下新建Storyboards文件夹来存放所有的Storyboard，这样的做法弊端是去相应的Storyboard和功能模块的VC太远，操作不便）；<br><strong>Resouces</strong>：资源文件夹，存放项目需要用到的音频、视频、图片（webP格式的图片或者内存比较大png只需要用到一份的背景图片）、字体、动画等等资源文件都放在此处；<br><strong>Util</strong>，一些工具类的文件夹，比如Objective-C的分类文件夹Category、swift扩展类的文件夹Extension，管理单例类文件夹Manager等等；<br><strong>Vendor</strong>，手动管理的第三方库，上图的BookRoom是我们FCS app的BookRoom模块都是封装为framework的形式引入的，所以就适合在此处添加，还有一些比较轻的第三方库就可以手动拖入代码添加进来，比如我们的项目中有一个获取适配型号的第三方库<code>DeviceUtil</code>，对于这类比较轻的库尽量使用手动拖入代码管理，毕竟项目中的framework多了，会影响app的启动时间，这个在<a href="https://developer.apple.com/videos/play/wwdc2016/406/" target="_blank" rel="noopener">WWDC 2016 Session 406 - Optimizing App Startup Time</a>的演讲中有讲原理；<br><strong>Pods</strong>  ：优秀的第三方库管理工具，比如网络请求<code>AFNetworking</code>，图片加载<code>SDWebImage</code>等等比较重的第三方库就可以使用Pods自动管理，当然你也可以使用Carthage来管理，具体使用哪个见仁见智，网络上也有很多关于这个的讨论。我们公司使用的是Pods，所以就是以Pods为🌰了；<br><strong>Appdelegate和首页</strong>：Appdelegate和首页是各个功能模块的入口，所以放在顶部最显眼的位置，（对于传统Tabbar+NavigationBar App的首页类文件可能会在对应的模块下）；<br><strong>Assets.xcassets、info.plist</strong>：这部分相对<code>Appdelegate</code>在同一目录下，但是放在最下面，这部分的操作频率不是太多，<strong>Assets.xcassets里面的图片，可以使用功能模块放置添加（New Folder，以模块命名）</strong>。</p>
</blockquote>
<p>看到这里，有的人会想：一个项目直接按照<strong>功能模块</strong>划分不也挺好的么，每个功能模块里面再按照MVC的模式划分，以下面这个app为例<img src="http://upload-images.jianshu.io/upload_images/1603505-305e4e6cb9e02b02.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="艺学机构版"><br>划分如下所示如下图所示：<img src="http://upload-images.jianshu.io/upload_images/1603505-62cb72af27c04c50.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="以功能模块划分工程框架图"><br>这两种搭建项目框架的模式没有孰优孰劣之分，只有得放到具体情境下面讨论才有意义，不过很明显，<strong>第二种以功能模块划分的模式适用于以小团队开发（iOS端2-3人以下）</strong>，这样每个人负责开发一个模块，效率非常高。<strong>如果团队人员比较多，则更适合采用第一种模式，这样开发效率更高</strong>，比如有人专门负责，网络层代码的编写，有人专门负责UI界面的编写，有人负责日志类的封装编写。</p>
<p>一些其他的小建议：</p>
<blockquote>
<ol>
<li>文件夹模块使用英文而不要使用中文命名，并且使用正确的英文名不要使用拼音；</li>
<li>名称首字母大写；</li>
<li>文件夹层数不要太多，最多三层；</li>
<li>快速定位某一个类文件的位置，光标在定位在类文件里面，按快捷键command+shift+J并可定位他的具体位置模块。</li>
</ol>
</blockquote>
<p><a href="https://github.com/XcqRomance/FastProjectFramework" target="_blank" rel="noopener">demo的GitHub地址</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/12/2017-12-12/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Romance">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/romance.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Romance的修行之路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/12/2017-12-12/" itemprop="url">一个iOS开发者的android修行之路三：布局开发单位对比(pt VS dp)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-12T18:31:54+08:00">
                2017-12-12
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/12/2017-12-12/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/12/2017-12-12/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>说到布局和适配，就不得不谈论下iOS和Android二者布局的单位：<strong>pt(point，点)和dp(Device independent pixel,Density independent pixel, DIP, DP，又叫与设备无关像素或与密度无关像素或密度独立像素)。</strong>注意：这里说的point和和印刷行业的单位point(<code>1pt = 1/72 inch</code>)是有区别的，看到好多文章都将iOS的pt和印刷行业的pt单位给等同起来这非常的误人子弟。</p>
<h2 id="先说结论："><a href="#先说结论：" class="headerlink" title="先说结论："></a>先说结论：</h2><ol>
<li><strong>相同点：都是为了适配不同屏幕不同尺寸的移动设备而设计出来的一种单位，用于表示UI布局尺寸与设备屏幕密度无关</strong></li>
<li><strong>不同点：一：pt是iOS设备的布局尺寸单位，苹果公司给的定义是：<code>1pt = 1/163 inch</code>，dp是android设备的布局尺寸单位，<a href="https://en.wikipedia.org/wiki/Device-independent_pixel" target="_blank" rel="noopener">Wikipedia给的定义</a>对于android设备：<code>1dp = 1/160 inch</code>；二：像素(pixels)和二者的转换关系不同：<code>iOS pt = pixels * ( ppi/163)</code>、<code>Android dp = pixels * (ppi/160)</code></strong> </li>
</ol>
<h2 id="在说二者的异同之前，我们得先清楚几个概念-以下概念都是在屏幕、显示器这个语境下的定义讨论的-："><a href="#在说二者的异同之前，我们得先清楚几个概念-以下概念都是在屏幕、显示器这个语境下的定义讨论的-：" class="headerlink" title="在说二者的异同之前，我们得先清楚几个概念(以下概念都是在屏幕、显示器这个语境下的定义讨论的)："></a>在说二者的异同之前，我们得先清楚几个概念(以下概念都是在屏幕、显示器这个语境下的定义讨论的)：</h2><ul>
<li><strong>inch：<a href="https://zh.wikipedia.org/wiki/%E8%8B%B1%E5%AF%B8" target="_blank" rel="noopener">英寸</a>，长度单位，1英寸 = 2.54 厘米；</strong></li>
<li><strong>px：pixels，<a href="https://zh.wikipedia.org/wiki/%E5%83%8F%E7%B4%A0" target="_blank" rel="noopener">像素</a>，组成图片、视频的基本显示单位；</strong></li>
<li><strong>dpi：dots per inch，<a href="https://zh.wikipedia.org/wiki/%E6%AF%8F%E8%8B%B1%E5%AF%B8%E7%82%B9%E6%95%B0" target="_blank" rel="noopener">每英寸的点数</a>又叫点密度；可以和下面的ppi概念等同</strong></li>
<li><strong>ppi：pixels per inch，<a href="https://zh.wikipedia.org/wiki/%E6%AF%8F%E8%8B%B1%E5%AF%B8%E5%83%8F%E7%B4%A0" target="_blank" rel="noopener">每英寸的像素值</a>又叫像素密度，每英寸像素值越高，屏幕能显示的图像也越精细，5ppi表示每平方英寸有5*5个px</strong></li>
<li><p><strong>屏幕尺寸(screen size)：最通俗的理解就是：屏幕对角线的长度</strong>，如5.8英寸的iPhoneX；<br><img src="http://upload-images.jianshu.io/upload_images/1603505-da29eb5aae9a2b71.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="5.8英寸的iPhoneX"></p>
</li>
<li><p><strong>屏幕分辨率(resolution)：手机的屏幕分辨率代表横向和纵向的像素值，如上图iPhoneX的分辨率是1125px * 2436px</strong></p>
</li>
</ul>
<p>通过上面的定义，我们知道ppi、屏幕尺寸、屏幕分辨率这三者的关系为：</p>
<h2 id="ppi-屏幕对角线的像素值-屏幕尺寸-√-屏幕横向像素值-2-屏幕纵向像素值-2-对角线长度"><a href="#ppi-屏幕对角线的像素值-屏幕尺寸-√-屏幕横向像素值-2-屏幕纵向像素值-2-对角线长度" class="headerlink" title="ppi = 屏幕对角线的像素值/屏幕尺寸 =  √ (屏幕横向像素值^2 + 屏幕纵向像素值^2)/对角线长度"></a><strong><code>ppi = 屏幕对角线的像素值/屏幕尺寸 =  √ (屏幕横向像素值^2 + 屏幕纵向像素值^2)/对角线长度</code></strong></h2><p>根据上面的公式，我们计算下<a href="https://www.apple.com/cn/iphone-x/specs/" target="_blank" rel="noopener">iPhoneX的像素密度</a>为：√ (1125^2 + 2436^2)/5.8 ≈ 458ppi</p>
<h2 id="px、pt、dp的相互转换"><a href="#px、pt、dp的相互转换" class="headerlink" title="px、pt、dp的相互转换"></a>px、pt、dp的相互转换</h2><ol>
<li>px、pt、dp是静态测量 - 它们不会因其他因素而改变；<br>1px总是1px，是可以显示颜色的屏幕中最小的一块。<br>1pt总是1pt，是一个抽象单位，只有与其他点相关时才有意义，dp同理。</li>
<li>pt、dp与px不同，因为它们根据ppi更改大小：<br>在iPhone上，当屏幕像素密度为163ppi时，也就是<a href="https://zh.wikipedia.org/wiki/Retina%E6%98%BE%E7%A4%BA%E5%B1%8F" title="Retina显示屏" target="_blank" rel="noopener">Retina显示屏</a>时代之前，所有的iPhone（iPhone 2G, 3G, 3GS），1pt等于1px；在326ppi上(iPhone 4,5和6)，1pt等于2px*2px，或总共4px素，意味着你的100x100图像将渲染在Retina设备上将是163ppi设备的四分之一大小；在401ppi上(iPhone 6Plus、7Plus、8Plus)这样的，1pt等于3px*3px，或者9px。<br><img src="http://upload-images.jianshu.io/upload_images/1603505-267baad8005f9b21.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="pt和px"><br>iPhone所有机型的分辨率如下图：<br><img src="http://upload-images.jianshu.io/upload_images/1603505-90f8a9bbb33fa7db.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="The Ultimate Guide To iPhone Resolutions"></li>
</ol>
<p>参考文章：</p>
<ol>
<li><a href="http://blog.fluidui.com/designing-for-mobile-101-pixels-points-and-resolutions/" target="_blank" rel="noopener">Mobile design 101: pixels, points and resolutions</a></li>
<li><a href="https://www.paintcodeapp.com/news/ultimate-guide-to-iphone-resolutions" target="_blank" rel="noopener">The Ultimate Guide To iPhone Resolutions</a></li>
<li><a href="https://www.zhihu.com/question/25421514/answer/31623909" target="_blank" rel="noopener">iOS 的 APP 在系统中如何适应 iPhone 5s/6/6 Plus 三种屏幕的尺寸</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/28/2017-11-28/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Romance">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/romance.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Romance的修行之路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/28/2017-11-28/" itemprop="url">一个iOS开发者的android修行之路二：UITableView和ListView的对比探究</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-28T16:24:49+08:00">
                2017-11-28
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/28/2017-11-28/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/28/2017-11-28/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>尽管现在主流的移动设备的屏幕尺寸都越来越大，特别是iPhone X的出现，以后的趋势都是全屏手机，但是一屏的显示的内容还是有限的，当我们需要有大量数据需要展示时就可以使用这两个控件。这两个控件的相同点都是允许用户上下滑动，以便展示屏幕区域外的内容。很多主流的应用，比如微信、QQ的消息列表，微信朋友圈，微博等等应用的很多界面都是使用这两个控件实现的。</p>
<h2 id="UITableView的基本使用"><a href="#UITableView的基本使用" class="headerlink" title="UITableView的基本使用"></a><code>UITableView</code>的基本使用</h2><ol>
<li>iOS添加一个<code>UITableView</code>有两种方式。一是：纯代码初始化一个<code>UITableView</code>；二是在<code>storyboard</code>中直接拖入一个<code>UITableView</code>并且设置约束添加，同时设置tableView的dataSource和delegate为ViewController。这两种方式并没有优劣之分，使用第二种方式是苹果推荐的快速开发的方式。我的事例代码选择的第二种方法。<br><img src="http://upload-images.jianshu.io/upload_images/1603505-23fde223e96c7a45.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="在storyboard添加UITableView的四步曲"></li>
<li><strong>自定义<code>UITableViewCell</code></strong>，勾选同时勾选xib,我这里命名为<code>TestTableViewCell</code>，里面添加两个控件ImageView和Label，同时设置应用。同时设置xib中的重用identifier为：<code>TestTableViewCell</code>。</li>
<li><p><strong>注册重用的cell</strong>，在<code>ViewController</code>的<code>viewDidLoad</code>方法中注册自定义cell。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> nib = <span class="type">UINib</span>(nibName: <span class="string">"TestTableViewCell"</span>, bundle: <span class="literal">nil</span>)</span><br><span class="line">tableView.register(nib, forCellReuseIdentifier: <span class="string">"TestTableViewCell"</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>配置tableView显示的数据源</strong>，实际项目中为网络请求的数据，demo中为模拟了100条假数据。</p>
</li>
<li><strong>实现<code>tableView</code>的数据源和代理方法。</strong><br>其中这两个数据源方法必须实现：<code>func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -&gt; Int</code>和<code>func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell</code>，否则会app会闪退。其中第一个方法用来指明cell的个数，第二个方法用来设置cell的数据，demo中的设置UIImageView和UILabel。<br>cell点击事件的响应，则需要实现代理方法<code>func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath)</code><br>下面是整个<code>ViewController</code>代码：<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  ViewController.swift</span></span><br><span class="line"><span class="comment">//  iOSTableViewDemo</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by romance on 2017/11/28.</span></span><br><span class="line"><span class="comment">//  Copyright © 2017年 firstleap. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> tableView: <span class="type">UITableView</span>!</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">fileprivate</span> <span class="keyword">var</span> dataList = [<span class="type">TestModel</span>]()</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> nib = <span class="type">UINib</span>(nibName: <span class="string">"TestTableViewCell"</span>, bundle: <span class="literal">nil</span>)</span><br><span class="line">    tableView.register(nib, forCellReuseIdentifier: <span class="string">"TestTableViewCell"</span>)</span><br><span class="line">    setupData()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">setupData</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="number">_</span> <span class="keyword">in</span> <span class="number">0</span>...<span class="number">100</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> model1 = <span class="type">TestModel</span>(imageName: <span class="string">"set_icon_about"</span>, title: <span class="string">"关于"</span>)</span><br><span class="line">      dataList.append(model1)</span><br><span class="line">      <span class="keyword">let</span> model2 = <span class="type">TestModel</span>(imageName: <span class="string">"set_icon_change"</span>, title: <span class="string">"头像"</span>)</span><br><span class="line">      dataList.append(model2)</span><br><span class="line">      <span class="keyword">let</span> model3 = <span class="type">TestModel</span>(imageName: <span class="string">"set_icon_clean"</span>, title: <span class="string">"清楚"</span>)</span><br><span class="line">      dataList.append(model3)</span><br><span class="line">      <span class="keyword">let</span> model4 = <span class="type">TestModel</span>(imageName: <span class="string">"set_icon_edit"</span>, title: <span class="string">"修改"</span>)</span><br><span class="line">      dataList.append(model4)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ViewController</span>: <span class="title">UITableViewDataSource</span>, <span class="title">UITableViewDelegate</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, numberOfRowsInSection section: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> dataList.<span class="built_in">count</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, cellForRowAt indexPath: IndexPath)</span></span> -&gt; <span class="type">UITableViewCell</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> cell = tableView.dequeueReusableCell(withIdentifier: <span class="string">"TestTableViewCell"</span>, <span class="keyword">for</span>: indexPath) <span class="keyword">as</span>! <span class="type">TestTableViewCell</span></span><br><span class="line">    <span class="keyword">let</span> model = dataList[indexPath.row]</span><br><span class="line">    cell.icon?.image = <span class="type">UIImage</span>(named: model.imageName);</span><br><span class="line">    cell.title?.text = model.title</span><br><span class="line">    <span class="keyword">return</span> cell</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, didSelectRowAt indexPath: IndexPath)</span></span> &#123;</span><br><span class="line">    tableView.deselectRow(at: indexPath, animated: <span class="literal">true</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> model = dataList[indexPath.row]</span><br><span class="line">    <span class="keyword">let</span> showtitle = model.title</span><br><span class="line">    <span class="keyword">let</span> label = <span class="type">UILabel</span>(frame: <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: <span class="number">100</span>, height: <span class="number">30</span>))</span><br><span class="line">    label.text = showtitle</span><br><span class="line">    label.textAlignment = .center</span><br><span class="line">    label.backgroundColor = .lightGray</span><br><span class="line">    label.center = view.center</span><br><span class="line">    label.alpha = <span class="number">0</span></span><br><span class="line">    <span class="keyword">self</span>.view.addSubview(label)</span><br><span class="line">    </span><br><span class="line">    <span class="type">UIView</span>.animate(withDuration: <span class="number">0.25</span>, animations: &#123;</span><br><span class="line">      label.alpha = <span class="number">1</span></span><br><span class="line">    &#125;) &#123; (b) <span class="keyword">in</span></span><br><span class="line">      <span class="type">DispatchQueue</span>.main.asyncAfter(deadline: <span class="type">DispatchTime</span>.now() + <span class="number">2</span>, execute: &#123;</span><br><span class="line">        <span class="type">UIView</span>.animate(withDuration: <span class="number">0.25</span>, animations: &#123;</span><br><span class="line">          label.alpha = <span class="number">0</span></span><br><span class="line">        &#125;, completion: &#123; (b) <span class="keyword">in</span></span><br><span class="line">          label.removeFromSuperview()</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="ListView的基本使用"><a href="#ListView的基本使用" class="headerlink" title="ListView的基本使用"></a><code>ListView</code>的基本使用</h2><ol>
<li><p><strong>在<code>activity_main.xml</code>中添加<code>ListView</code>布局，充满父容器</strong>，其实iOS中的storyboard和xib文件也是xml语言编写（也就是说和android的xml文件类似），只不过苹果公司开发Xcode可以图形化界面进行设置约束，而Android Studio尽管也可以通过拖控件进行布局，但是一般都不使用。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ListView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/list_view"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>设置<code>ListView</code>子项布局test_item.xml。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/test_image"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:src</span>=<span class="string">"@drawable/set_icon_about"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/test_tile"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">"center_vertical"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"hehe"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textSize</span>=<span class="string">"21sp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginLeft</span>=<span class="string">"8dp"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>自定义<code>ListView</code>的适配器<code>TestAdapter</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestAdapter</span> <span class="keyword">extends</span> <span class="title">ArrayAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> resourceID;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TestAdapter</span><span class="params">(@NonNull Context context, <span class="keyword">int</span> resource, List&lt;TestModel&gt; objects)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, resource,objects);</span><br><span class="line">        resourceID = resource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, @Nullable View convertView, @NonNull ViewGroup parent)</span> </span>&#123;</span><br><span class="line">        TestModel testModel = (TestModel)getItem(position);</span><br><span class="line">        View view;</span><br><span class="line">        ViewHolder viewHolder;</span><br><span class="line">        <span class="keyword">if</span> (convertView == <span class="keyword">null</span>) &#123;</span><br><span class="line">            view = LayoutInflater.from(getContext()).inflate(resourceID, parent, <span class="keyword">false</span>);</span><br><span class="line">            viewHolder = <span class="keyword">new</span> ViewHolder(view);</span><br><span class="line">            view.setTag(viewHolder);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            view = convertView;</span><br><span class="line">            viewHolder = (ViewHolder)view.getTag();</span><br><span class="line">        &#125;</span><br><span class="line">        viewHolder.imageView.setImageResource(testModel.getImageID());</span><br><span class="line">        viewHolder.textView.setText(testModel.getTitle());</span><br><span class="line">        <span class="keyword">return</span> view;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> </span>&#123;</span><br><span class="line">        ImageView imageView;</span><br><span class="line">        TextView textView;</span><br><span class="line">        ViewHolder(View view ) &#123;</span><br><span class="line">            imageView = (ImageView)view.findViewById(R.id.test_image);</span><br><span class="line">            textView = (TextView)view.findViewById(R.id.test_tile);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加Adapter数据，同iOS类似，demo添加了100条假数据。</p>
</li>
<li>在<code>onCreate</code>方法中创建一个<code>TestAdapter</code>对象adapter，并且设置为listView的适配器。为<code>ListView</code>item子项添加点击事件。<br><code>MainActivity</code>的代码如下：<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="title">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">List</span>&lt;<span class="type">TestModel</span>&gt; dataList = new <span class="type">ArrayList</span>&lt;&gt;();</span><br><span class="line">    @<span class="type">Override</span></span><br><span class="line">    protected void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(<span class="type">R</span>.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        initsData();</span><br><span class="line">        <span class="type">TestAdapter</span> adapter = new <span class="type">TestAdapter</span>(<span class="type">MainActivity</span>.this,<span class="type">R</span>.layout.test_item,dataList);</span><br><span class="line">        <span class="type">ListView</span> listView = (<span class="type">ListView</span>)findViewById(<span class="type">R</span>.id.list_view);</span><br><span class="line">        listView.setAdapter(adapter);</span><br><span class="line">        listView.setOnItemClickListener(new <span class="type">AdapterView</span>.<span class="type">OnItemClickListener</span>() &#123;</span><br><span class="line">            @<span class="type">Override</span></span><br><span class="line">            <span class="keyword">public</span> void onItemClick(<span class="type">AdapterView</span>&lt;?&gt; adapterView, <span class="type">View</span> view, int i, long l) &#123;</span><br><span class="line">                <span class="type">TestModel</span> model = dataList.<span class="keyword">get</span>(i);</span><br><span class="line">                <span class="type">Toast</span>.makeText(<span class="type">MainActivity</span>.this,model.getTitle(),<span class="type">Toast</span>.<span class="type">LENGTH_SHORT</span>).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> void initsData() &#123;</span><br><span class="line">        <span class="keyword">for</span> (int i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i ++) &#123;</span><br><span class="line">            <span class="type">TestModel</span> testModel = new <span class="type">TestModel</span>(<span class="type">R</span>.drawable.set_icon_about,<span class="string">"关于"</span>);</span><br><span class="line">            dataList.add(testModel);</span><br><span class="line">            <span class="type">TestModel</span> testModel2 = new <span class="type">TestModel</span>(<span class="type">R</span>.drawable.set_icon_change,<span class="string">"头像"</span>);</span><br><span class="line">            dataList.add(testModel2);</span><br><span class="line">            <span class="type">TestModel</span> testModel3 = new <span class="type">TestModel</span>(<span class="type">R</span>.drawable.set_icon_clean,<span class="string">"清楚"</span>);</span><br><span class="line">            dataList.add(testModel3);</span><br><span class="line">            <span class="type">TestModel</span> testModel4 = new <span class="type">TestModel</span>(<span class="type">R</span>.drawable.set_icon_edit,<span class="string">"修改"</span>);</span><br><span class="line">            dataList.add(testModel4);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="UITableView和ListView的对比"><a href="#UITableView和ListView的对比" class="headerlink" title="UITableView和ListView的对比"></a>UITableView和ListView的对比</h2><p>相同点：</p>
<ol>
<li>都有重用机制，来提高滑动性能；</li>
<li>见文章开头所写；</li>
</ol>
<p>不同点：</p>
<ol>
<li><code>UITableView</code>继承自<code>UIScrollView</code>是一个滑动的View，而ListView则不是集成ScrollView。（或许这两点并没有没有可比性，毕竟是两个不同框架提供的库）</li>
<li><code>UITableView</code>有两种样式，group和plain。而<code>ListView</code>只有一种类似于iOS的plain模式，<br><img src="http://upload-images.jianshu.io/upload_images/1603505-e0cd8fc6becd757c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="group样式"><br><img src="http://upload-images.jianshu.io/upload_images/1603505-29d30456590ecad4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="plain样式"></li>
</ol>
<p>最后，文中使用的控件对比：<br>iOS图片显示控件UIImageView与Android的ImageView控件对应，文本显示控件iOS是UILabel，对应Android的TextView。<br><a href="https://github.com/XcqRomance/iOS_Android_Comparision/tree/listViewVStableView" target="_blank" rel="noopener">GitHub demo地址</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/24/2017-11-24/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Romance">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/romance.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Romance的修行之路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/24/2017-11-24/" itemprop="url">一个iOS开发者的android修行之路一：UIViewController与Activity的生命周期对比探究</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-24T10:41:22+08:00">
                2017-11-24
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/24/2017-11-24/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/24/2017-11-24/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>先说说自己学习安卓的一个初衷，在移动app开发的过程中，经常和android开发人员讨论一些技术的实现，有时候交流起来就特费劲，不是他听不懂我说的术语，就是他听不懂我讲的什么，反正就是有点语言不通，比如：iOS中的集合视图UITableView、UICollectionView中每个子项一般叫做cell，讨论的时候也叫做cell中干啥干啥，而安卓中的集合视图ListView,GridView,RecyclerView的每一个子项叫做item，这个还是小的差异；还有就是讨论某个UI界面数据刷新是什么时机进行刷新的，我说我们这边是在viewWillAppear的时候进行刷新，然后android那边就懵逼了，直到我换了一种说法，就是在这个页面即将显示的时候刷新数据，对方才听懂；而有时候我们听到对方的一些名词的时候，会想这Activity是什么东东？Fragment又是什么？于是我们会联想这对应到我们iOS这边相应的是什么。总之，诸如此类的听到对方说的一些名词自己云里雾里的。<strong>其实，一个更为重要的原因是想要成为移动开发的leader，你不懂一些android的开发，以及了解android和iOS的一些差异，你是没法胜任这个工作的。有时候，android遇到一些坑时，你必须知道如何高效的解决。如何和小组开发人员探讨某个问题的最佳实践。</strong></p>
<h2 id="Activity的生命周期"><a href="#Activity的生命周期" class="headerlink" title="Activity的生命周期"></a>Activity的生命周期</h2><p><strong>一个优秀app必须兼顾两个必要条件：1、优秀的界面，2、良好的用户交互体验。</strong><br>在iOS中是由UIViewController主要负责加载界面呈现给用户，以及处理用户的交互逻辑；而安卓负责界面展示和交互功能就是Android系统四大组件之一的活动<strong>Activity</strong>。<br><strong>1. 我们先看下iOS的<code>UIViewController</code>的生命周期函数：</strong><br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 前两个init方法是UIViewController的初始化方法</span></span><br><span class="line">  <span class="comment">// 非storyboard加载会调用此方法</span></span><br><span class="line">  <span class="keyword">override</span> <span class="keyword">init</span>(nibName nibNameOrNil: <span class="type">String</span>?, bundle nibBundleOrNil: <span class="type">Bundle</span>?) &#123;</span><br><span class="line">    <span class="keyword">super</span>.<span class="keyword">init</span>(nibName: nibNameOrNil, bundle: nibBundleOrNil)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"<span class="subst">\(<span class="keyword">self</span>)</span><span class="subst">\(#function)</span>"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 使用storyboard加载的UIViewController会调用此初始化方法</span></span><br><span class="line">  <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">    <span class="keyword">super</span>.<span class="keyword">init</span>(coder: aDecoder)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"<span class="subst">\(<span class="keyword">self</span>)</span><span class="subst">\(#function)</span>"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 视图的@IBOutlet和@IBAction链接完成再次方法中</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">awakeFromNib</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.awakeFromNib()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"<span class="subst">\(<span class="keyword">self</span>)</span><span class="subst">\(#function)</span>"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Creates the view that the controller manages.</span></span><br><span class="line">  <span class="comment">// 此方法一般调用的少</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">loadView</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.loadView()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"<span class="subst">\(<span class="keyword">self</span>)</span><span class="subst">\(#function)</span>"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Called after the controller's view is loaded into memory.</span></span><br><span class="line">  <span class="comment">// 控制器视图加载完成（加载到了内存）的时候调用,只被调用一次，我们一般在这个方法中进行数据的网路请求，约束的设置，以及视图的一些操作等等。</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"<span class="subst">\(<span class="keyword">self</span>)</span><span class="subst">\(#function)</span>"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// MARK: -分割线----上面的方法只会调用一次，下面的方法除了deinit方法可能会调用多次</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Notifies the view controller that its view is about to be added to a view hierarchy.</span></span><br><span class="line">  <span class="comment">// 视图即将显示的时候调用</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillAppear</span><span class="params">(<span class="number">_</span> animated: Bool)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewWillAppear(animated)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"<span class="subst">\(<span class="keyword">self</span>)</span><span class="subst">\(#function)</span>"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Called to notify the view controller that its view is about to layout its subviews.</span></span><br><span class="line">  <span class="comment">// 控制器视图即将布局他的子视图时调用</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillLayoutSubviews</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewWillLayoutSubviews()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"<span class="subst">\(<span class="keyword">self</span>)</span><span class="subst">\(#function)</span>"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Called to notify the view controller that its view has just laid out its subviews.</span></span><br><span class="line">  <span class="comment">// 控制器视图已经布局完其子视图后调用，在iphone X的适配就是在此方法中获取view.safeAreaInsets进行处理的，</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLayoutSubviews</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewDidLayoutSubviews()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"<span class="subst">\(<span class="keyword">self</span>)</span><span class="subst">\(#function)</span>"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Notifies the view controller that its view was added to a view hierarchy.</span></span><br><span class="line">  <span class="comment">// 试图已经完全显示的时候调用</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidAppear</span><span class="params">(<span class="number">_</span> animated: Bool)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewDidAppear(animated)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"<span class="subst">\(<span class="keyword">self</span>)</span><span class="subst">\(#function)</span>"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Notifies the view controller that its view is about to be removed from a view hierarchy.</span></span><br><span class="line">  <span class="comment">// 视图即将被移除的时候调用</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillDisappear</span><span class="params">(<span class="number">_</span> animated: Bool)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewWillDisappear(animated)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"<span class="subst">\(<span class="keyword">self</span>)</span><span class="subst">\(#function)</span>"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Notifies the view controller that its view was removed from a view hierarchy.</span></span><br><span class="line">  <span class="comment">// 视图已经被完全移除的时候调用</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidDisappear</span><span class="params">(<span class="number">_</span> animated: Bool)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewDidAppear(animated)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"<span class="subst">\(<span class="keyword">self</span>)</span><span class="subst">\(#function)</span>"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Sent to the view controller when the app receives a memory warning.</span></span><br><span class="line">  <span class="comment">// 手机收到内存警告的时候调用</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">didReceiveMemoryWarning</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.didReceiveMemoryWarning()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"<span class="subst">\(<span class="keyword">self</span>)</span><span class="subst">\(#function)</span>"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 视图被销毁的时候调用，在这里可以执行的操作有：KVO移除，通知的移除，定时器的销毁</span></span><br><span class="line">  <span class="keyword">deinit</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"<span class="subst">\(<span class="keyword">self</span>)</span><span class="subst">\(#function)</span>"</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>下面是从ViewController跳转到SecondViewControler在跳转到ThirdController控制台的log：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;LifecycleDemo.ViewController: 0x7fd122d0b5d0&gt;init(coder:)</span><br><span class="line">&lt;LifecycleDemo.ViewController: 0x7fd122d0b5d0&gt;awakeFromNib()</span><br><span class="line">&lt;LifecycleDemo.ViewController: 0x7fd122d0b5d0&gt;loadView()</span><br><span class="line">&lt;LifecycleDemo.ViewController: 0x7fd122d0b5d0&gt;viewDidLoad()</span><br><span class="line">&lt;LifecycleDemo.ViewController: 0x7fd122d0b5d0&gt;viewWillAppear</span><br><span class="line">&lt;LifecycleDemo.ViewController: 0x7fd122d0b5d0&gt;viewWillLayoutSubviews()</span><br><span class="line">&lt;LifecycleDemo.ViewController: 0x7fd122d0b5d0&gt;viewDidLayoutSubviews()</span><br><span class="line">&lt;LifecycleDemo.ViewController: 0x7fd122d0b5d0&gt;viewWillLayoutSubviews()</span><br><span class="line">&lt;LifecycleDemo.ViewController: 0x7fd122d0b5d0&gt;viewDidLayoutSubviews()</span><br><span class="line">&lt;LifecycleDemo.ViewController: 0x7fd122d0b5d0&gt;viewDidAppear</span><br><span class="line">&lt;LifecycleDemo.SecondViewController: 0x7fd122c16480&gt;init(coder:)</span><br><span class="line">&lt;LifecycleDemo.SecondViewController: 0x7fd122c16480&gt;awakeFromNib()</span><br><span class="line">&lt;LifecycleDemo.SecondViewController: 0x7fd122c16480&gt;loadView()</span><br><span class="line">&lt;LifecycleDemo.SecondViewController: 0x7fd122c16480&gt;viewDidLoad()</span><br><span class="line">&lt;LifecycleDemo.ViewController: 0x7fd122d0b5d0&gt;viewWillDisappear</span><br><span class="line">&lt;LifecycleDemo.SecondViewController: 0x7fd122c16480&gt;viewWillAppear</span><br><span class="line">&lt;LifecycleDemo.SecondViewController: 0x7fd122c16480&gt;viewWillLayoutSubviews()</span><br><span class="line">&lt;LifecycleDemo.SecondViewController: 0x7fd122c16480&gt;viewDidLayoutSubviews()</span><br><span class="line">&lt;LifecycleDemo.SecondViewController: 0x7fd122c16480&gt;viewWillLayoutSubviews()</span><br><span class="line">&lt;LifecycleDemo.SecondViewController: 0x7fd122c16480&gt;viewDidLayoutSubviews()</span><br><span class="line">&lt;LifecycleDemo.ViewController: 0x7fd122d0b5d0&gt;viewDidDisappear</span><br><span class="line">&lt;LifecycleDemo.SecondViewController: 0x7fd122c16480&gt;viewDidAppear</span><br><span class="line">&lt;LifecycleDemo.ThirdViewController: 0x7fd122c2ff00&gt;init(nibName:bundle:)</span><br><span class="line">&lt;LifecycleDemo.ThirdViewController: 0x7fd122c2ff00&gt;loadView()</span><br><span class="line">&lt;LifecycleDemo.ThirdViewController: 0x7fd122c2ff00&gt;viewDidLoad()</span><br><span class="line">&lt;LifecycleDemo.SecondViewController: 0x7fd122c16480&gt;viewWillDisappear</span><br><span class="line">&lt;LifecycleDemo.ThirdViewController: 0x7fd122c2ff00&gt;viewWillAppear</span><br><span class="line">&lt;LifecycleDemo.ThirdViewController: 0x7fd122c2ff00&gt;viewWillLayoutSubviews()</span><br><span class="line">&lt;LifecycleDemo.ThirdViewController: 0x7fd122c2ff00&gt;viewDidLayoutSubviews()</span><br><span class="line">&lt;LifecycleDemo.ThirdViewController: 0x7fd122c2ff00&gt;viewWillLayoutSubviews()</span><br><span class="line">&lt;LifecycleDemo.ThirdViewController: 0x7fd122c2ff00&gt;viewDidLayoutSubviews()</span><br><span class="line">&lt;LifecycleDemo.SecondViewController: 0x7fd122c16480&gt;viewDidDisappear</span><br><span class="line">&lt;LifecycleDemo.ThirdViewController: 0x7fd122c2ff00&gt;viewDidAppear</span><br><span class="line">&lt;LifecycleDemo.ThirdViewController: 0x7fd122c2ff00&gt;viewWillDisappear</span><br><span class="line">&lt;LifecycleDemo.SecondViewController: 0x7fd122c16480&gt;viewWillAppear</span><br><span class="line">&lt;LifecycleDemo.ThirdViewController: 0x7fd122c2ff00&gt;viewDidDisappear</span><br><span class="line">&lt;LifecycleDemo.SecondViewController: 0x7fd122c16480&gt;viewDidAppear</span><br><span class="line">&lt;LifecycleDemo.ThirdViewController: 0x7fd122c2ff00&gt;deinit</span><br><span class="line">&lt;LifecycleDemo.SecondViewController: 0x7fd122c16480&gt;viewWillDisappear</span><br><span class="line">&lt;LifecycleDemo.ViewController: 0x7fd122d0b5d0&gt;viewWillAppear</span><br><span class="line">&lt;LifecycleDemo.SecondViewController: 0x7fd122c16480&gt;viewDidDisappear</span><br><span class="line">&lt;LifecycleDemo.ViewController: 0x7fd122d0b5d0&gt;viewDidAppear</span><br><span class="line">&lt;LifecycleDemo.SecondViewController: 0x7fd122c16480&gt;deinit</span><br></pre></td></tr></table></figure></p>
<p><strong>2. 我们再来看下android的Activity的生命周期函数：</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    String str = <span class="keyword">this</span>.getClass().getName();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*活动第一次被创建的时候调用，布局的加载，事件的绑定可以在这里完成,此时活动还是不可见的*/</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        Log.i(str,<span class="string">"onCreate"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*活动由不可见变为可见的时候调用*/</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onStart();</span><br><span class="line">        Log.i(str,<span class="string">"onStart"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*活动已经完全可见，并且可以与用户交互，活动处于返回栈的栈顶*/</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onResume();</span><br><span class="line">        Log.i(str,<span class="string">"onResume"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*在系统准备启动或者恢复一个activity时调用*/</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPause</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onPause();</span><br><span class="line">        Log.i(str,<span class="string">"onPause"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*当activity 完全不可见的时候调用*/</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onStop();</span><br><span class="line">        Log.i(str,<span class="string">"onStop"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*活动被重新启动的时候调用*/</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onRestart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onRestart();</span><br><span class="line">        Log.i(str,<span class="string">"onRestart"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*acitivity被销毁前调用，调用之后，activity变为销毁状态*/</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        Log.i(str,<span class="string">"onDestroy"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>下面是一个MainActivity跳转到SecondActivity，然后在回来的生命函数调用在控制台输出的log：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">I/com.example.xcqromance.lifecycledemo.MainActivity: onCreate</span><br><span class="line">I/com.example.xcqromance.lifecycledemo.MainActivity: onStart</span><br><span class="line">I/com.example.xcqromance.lifecycledemo.MainActivity: onResume</span><br><span class="line">I/com.example.xcqromance.lifecycledemo.MainActivity: onPause</span><br><span class="line">I/com.example.xcqromance.lifecycledemo.SecondActivity: onCreate</span><br><span class="line">I/com.example.xcqromance.lifecycledemo.SecondActivity: onStart</span><br><span class="line">I/com.example.xcqromance.lifecycledemo.SecondActivity: onResume</span><br><span class="line">I/com.example.xcqromance.lifecycledemo.MainActivity: onStop</span><br><span class="line">I/com.example.xcqromance.lifecycledemo.SecondActivity: onPause</span><br><span class="line">I/com.example.xcqromance.lifecycledemo.MainActivity: onRestart</span><br><span class="line">I/com.example.xcqromance.lifecycledemo.MainActivity: onStart</span><br><span class="line">I/com.example.xcqromance.lifecycledemo.MainActivity: onResume</span><br><span class="line">I/com.example.xcqromance.lifecycledemo.SecondActivity: onStop</span><br><span class="line">I/com.example.xcqromance.lifecycledemo.SecondActivity: onDestroy</span><br></pre></td></tr></table></figure></p>
<p>通过上面的对比，我整理出iOS和android的生命周期函数有及其相似的地方和不同之处：<img src="http://upload-images.jianshu.io/upload_images/1603505-54975d9746a96bd7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="iOS和android生命周期函数对比图"></p>
<p><a href="https://github.com/XcqRomance/iOS_Android_Comparision/tree/lifecycle" target="_blank" rel="noopener">GithubDemo地址</a>，里面有上述操作的代码，文章写的有点粗糙，同时欢迎大家一切探讨。一起添加iOS和android的生命周期的异同。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/19/2017-10-19/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Romance">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/romance.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Romance的修行之路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/19/2017-10-19/" itemprop="url">iOS11,iPhoneX适配,Xcode9遇到的问题以及解决方案探讨</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-19T12:01:22+08:00">
                2017-10-19
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/10/19/2017-10-19/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/10/19/2017-10-19/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>以下问题是自己在升级Xcode9后，在iOS11设备运行项目后遇到的问题，在此记录，说不定你也到过类似的问题，我们可以一起探讨，解决问题。</p>
<h2 id="自定义导航栏高度无效"><a href="#自定义导航栏高度无效" class="headerlink" title="自定义导航栏高度无效"></a><strong>自定义导航栏高度无效</strong></h2><p>使用Xcode9和Xcode8运行同样一份代码，Xcode8中运行到iOS11系统的手机上导航栏高度是自定义的高度，而Xcode9运行高度就成了系统的44pt的高度了；目前还没有找到有效的解决方案；之前iOS11beta5版本苹果给修复了这个bug，正式系统发布后又出现了这个问题；<br>区别如下：<br><img src="http://upload-images.jianshu.io/upload_images/1603505-ab1ec39839f94589.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>自定义<code>UINavigationBar</code>代码如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">let</span> customNavigationBarHeight: <span class="type">CGFloat</span> = isPad ? <span class="number">75</span> : <span class="number">60</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomNavigationBar</span>: <span class="title">UINavigationBar</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">sizeThatFits</span><span class="params">(<span class="number">_</span> size: CGSize)</span></span> -&gt; <span class="type">CGSize</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">CGSize</span>(width: <span class="type">UIScreen</span>.main.bounds.width, height: customNavigationBarHeight)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">layoutSubviews</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.layoutSubviews()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> subview <span class="keyword">in</span> subviews &#123;</span><br><span class="line">      subview.center.y = frame.height / <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">titleVerticalPositionAdjustment</span><span class="params">(<span class="keyword">for</span> barMetrics: UIBarMetrics)</span></span> -&gt; <span class="type">CGFloat</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> -(frame.height - <span class="number">44</span>)/<span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在stackeroverflow曾经搜索到一个解决方案的确能够在iOS11设备上修改导航栏高度，但是存在两个问题：第一导航栏标题栏不垂直居中；第二导航控制器的rootviewcontroller如果是tableVeiwController或者有tableView的topInset还是44pt，没有相应的跟着导航栏的高度下移：<br>重写layoutSubviews()的方法如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">layoutSubviews</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">super</span>.layoutSubviews()</span><br><span class="line"></span><br><span class="line">  backgroundColor = .black</span><br><span class="line">  frame = <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: <span class="type">UIScreen</span>.main.bounds.width, height: customNavigationBarHeight)</span><br><span class="line">  <span class="keyword">for</span> subview <span class="keyword">in</span> <span class="keyword">self</span>.subviews &#123;</span><br><span class="line">    printLog(subview)</span><br><span class="line">    <span class="keyword">let</span> stringFromClass = <span class="type">NSStringFromClass</span>(subview.classForCoder)</span><br><span class="line">    <span class="keyword">if</span> stringFromClass.<span class="built_in">contains</span>(<span class="string">"BarBackground"</span>) &#123;</span><br><span class="line">      subview.frame = <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: <span class="keyword">self</span>.frame.width, height: customNavigationBarHeight)</span><br><span class="line">      subview.backgroundColor = .blue<span class="comment">//self.backgroundColor</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> stringFromClass.<span class="built_in">contains</span>(<span class="string">"BarContent"</span>) &#123;</span><br><span class="line">      subview.frame = <span class="type">CGRect</span>(x: subview.frame.origin.x, y: <span class="number">0</span>, width: subview.frame.width, height: customNavigationBarHeight)</span><br><span class="line">      subview.backgroundColor = .red<span class="comment">//self.backgroundColor</span></span><br><span class="line">      subview.center.y = customNavigationBarHeight / <span class="number">2</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      subview.center.y = frame.height / <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>效果和分析图如下：<br><img src="http://upload-images.jianshu.io/upload_images/1603505-8ed88a5b9da74b28.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><img src="http://upload-images.jianshu.io/upload_images/1603505-9e4c0e13a94b2a95.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>这个问题还有待进一步探讨解决方案，如果哪位有解决方案，我们可以一起探讨下！</p>
<h2 id="使用Xcode9打包上传构建版本时，收到警告，意思是缺少1024x1024px的Icon图片；"><a href="#使用Xcode9打包上传构建版本时，收到警告，意思是缺少1024x1024px的Icon图片；" class="headerlink" title="使用Xcode9打包上传构建版本时，收到警告，意思是缺少1024x1024px的Icon图片；"></a>使用Xcode9打包上传构建版本时，收到警告，意思是<strong>缺少1024x1024px的Icon图片</strong>；</h2><p><strong>解决方案：在项目Assets.xcassets的AppIcon中添加一张要求尺寸的Icon图片；</strong><br>邮件内容如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Dear developer,</span><br><span class="line"></span><br><span class="line">We have discovered one or more issues with your recent delivery for &quot;励步云学习&quot;. Your delivery was successful, but you may wish to correct the following issues in your next delivery:</span><br><span class="line"></span><br><span class="line">Missing Marketing Icon - iOS Apps must include a 1024x1024px Marketing Icon in PNG format. Apps that do not include the Marketing Icon cannot be submitted for App Review or Beta App Review.</span><br><span class="line"></span><br><span class="line">After you’ve corrected the issues, you can use Xcode or Application Loader to upload a new binary to iTunes Connect.</span><br><span class="line"></span><br><span class="line">Regards,</span><br><span class="line"></span><br><span class="line">The App Store team</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1603505-858e1800b567ebb8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1024x1024尺寸的Icon"><br>同时记得叫UI添加iPhone X的LaunchImage。</p>
<h2 id="swift版本不匹配的问题"><a href="#swift版本不匹配的问题" class="headerlink" title="swift版本不匹配的问题"></a><strong>swift版本不匹配的问题</strong></h2><p>如果我们项目中使用的一些依赖库是使用swift语言构建的framework，从Xcode8升级到Xcode9后是编译不过的，提示swift Module版本不匹配的错误，此时我们只需要使用Xcode9重新编译对应的framework就能够编译通过。</p>
<h2 id="添加用户隐私协议提交AppStore审核，审核时间将近一个月被拒"><a href="#添加用户隐私协议提交AppStore审核，审核时间将近一个月被拒" class="headerlink" title="添加用户隐私协议提交AppStore审核，审核时间将近一个月被拒"></a><strong>添加用户隐私协议提交AppStore审核，审核时间将近一个月被拒</strong></h2><p>我们公司国庆放假前一两周提交了一个版本，解决了iOS11的一些闪退和适配问题，同时添加了用户隐私条款，结果国庆放假回来之后还在审核中，审核期间我们发了无数封加急邮件，但是一直都是的回复都是正在审核！后面经过排查很打原因是用户隐私策略的添加导致的，尽管这个用户隐私协议条款的内容是公司集团法务提供的，但是好像苹果公司还得审核你的隐私协议内容。后面果断撤回这个版本（大量用户升级iOS11系统后反馈app里面的一个播放视频模块闪退，后面锁定原因是我们建立的播放视频类类名和系统的类重名了），<strong>去除隐私条款再重新提交一个新的构建版本，再写一封加急邮件，第二天立马通过审核。</strong>几天后，同时集团的其他部门提交的包含隐私策略的版本被拒，血的教训，血的坑啊！</p>
<h2 id="iOS11系统设备保存图片到系统相册闪退"><a href="#iOS11系统设备保存图片到系统相册闪退" class="headerlink" title="iOS11系统设备保存图片到系统相册闪退"></a><strong>iOS11系统设备保存图片到系统相册闪退</strong></h2><p>解决方案：<strong>在info.plist中添加访问权限，key:<code>NSPhotoLibraryAddUsageDescription</code>,value:<code>是否允许$(PRODUCT_NAME)访问你的相册？</code></strong>。</p>
<h2 id="tableView在iOS11设备两边留白"><a href="#tableView在iOS11设备两边留白" class="headerlink" title="tableView在iOS11设备两边留白"></a><strong>tableView在iOS11设备两边留白</strong></h2><p>如左下图红色方框留白间隙部分，以及解决后的效果右下图：<br><img src="http://upload-images.jianshu.io/upload_images/1603505-d69d682d80572636.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>解决方案：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> #available(iOS <span class="number">9.0</span>, *) &#123;</span><br><span class="line">    tableView.cellLayoutMarginsFollowReadableWidth = <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="iphoneX的适配问题"><a href="#iphoneX的适配问题" class="headerlink" title="iphoneX的适配问题"></a><strong>iphoneX的适配问题</strong></h2><p>由于我们公司项目中大部分都是使用storyboard开发用autolayout进行布局，所以整个iPhoneX的布局适配只花了一天就完成。iPhoneX的适配规则我认为很简单：根据苹果建议的规则以及UI给你的效果图进行修改，比如我们这边是使用苹果官方推荐的左右留白相应的距离，在安全区域(Safe Area)内布局，安全区域外的内容就别添加点击事件。具体可以查看下这两篇文章<a href="http://www.ui.cn/detail/283956.html" target="_blank" rel="noopener">三分钟弄懂iPhone X 设计尺寸和适配</a>，<a href="https://mp.weixin.qq.com/s/micJH7ImLOJrnXrpxUCq1A" target="_blank" rel="noopener">关于 iPhone X 产品汪和设计狮应该了解的事之四</a>，看完这两篇文章你对iPhoneX也就基本了解了。<br>先看一组界面错乱的UI<br><img src="http://upload-images.jianshu.io/upload_images/1603505-191bae71ea683598.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3 id="AutoLayout布局的iPhoneX适配；"><a href="#AutoLayout布局的iPhoneX适配；" class="headerlink" title="AutoLayout布局的iPhoneX适配；"></a><strong>AutoLayout布局的iPhoneX适配；</strong></h3><p>很多项目的部署版本可能是低于iOS9的，那么<code>Safe Area Layout Guides</code>布局就不支持，但是这并不影响在iPhoneX的自动适配。刚升级到Xcode9时报的一个storyboard的错误就是<code>Safe Area Layout Guides before iOS 9.0</code>，应为这个选项默认是打开的，我们只需将其关闭就行。<strong>第一、</strong>像tableView，collectionView这种集合视图，autolayout已经给我们自动适配好了，我们不需要做过多的修改。如上图，左右下三边的白色部分就是自动适配好了距离，我只需将这部分颜色改为tableview的深色就适配好了。<strong>第二、</strong>上图顶部黄色区域内的左右两边距离还得添加<code>view.safeAreaInsets</code>左右两边的距离，这部分的适配只需将约束引出一个<code>IBOutlet</code>，然后在<code>viewDidLayoutSubviews</code>方法中重新设置，具体代码如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> backBtnLeadingCons: <span class="type">NSLayoutConstraint</span>!</span><br><span class="line"><span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> stageViewTrailingCons: <span class="type">NSLayoutConstraint</span>!</span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLayoutSubviews</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">super</span>.viewDidLayoutSubviews()</span><br><span class="line">  <span class="keyword">if</span> #available(iOS <span class="number">11.0</span>, *) &#123;</span><br><span class="line">    <span class="keyword">let</span> inset = view.safeAreaInsets</span><br><span class="line">    printLog(inset)</span><br><span class="line">    backBtnLeadingCons.constant = inset.<span class="keyword">left</span> + <span class="number">20</span></span><br><span class="line">    stageViewTrailingCons.constant = inset.<span class="keyword">right</span> + <span class="number">10</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>修改后的效果图：<br><img src="http://upload-images.jianshu.io/upload_images/1603505-5276a72347f6c05b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="iPhoneX的适配效果图"><br>还有一点要注意的是：使用Auto Layout的距离底部约束的区别，<br><img src="http://upload-images.jianshu.io/upload_images/1603505-8a4e30e827382204.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="">勾选第一个是下图左边的布局，勾选下面一个是下图右边与底部挨着对齐的布局。<br><img src="http://upload-images.jianshu.io/upload_images/1603505-c479dd4d51bdb214.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>具体选哪种这个得更具产品要求设置即可，我这里选择第二种，与底部对齐，因为底部并没有与用户交互的事件，这样做更加符合审美。</p>
<h3 id="代码约束-如Masonry-或者手写控件frame适配iPhoneX"><a href="#代码约束-如Masonry-或者手写控件frame适配iPhoneX" class="headerlink" title="代码约束(如Masonry)或者手写控件frame适配iPhoneX"></a><strong>代码约束(如Masonry)或者手写控件frame适配iPhoneX</strong></h3><p>这种情况的就需要单独针对iPhoneX写一套约束或者控件的frame。此时我们可以在定义一个全局常量(以swift为例):<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 屏幕宽高</span></span><br><span class="line"><span class="keyword">let</span> kScreenWidth = <span class="type">UIScreen</span>.main.bounds.size.width</span><br><span class="line"><span class="keyword">let</span> kScreenHeight = <span class="type">UIScreen</span>.main.bounds.size.height</span><br><span class="line"><span class="keyword">let</span> isiPhoneX = (<span class="built_in">max</span>(kScreenWidth, kScreenHeight) == <span class="number">812</span> &amp;&amp; <span class="built_in">min</span>(kScreenWidth, kScreenHeight) == <span class="number">375</span>)</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>暂时遇到的问题就这么多，以后遇到坑在添加，同时欢迎大家添加遇到的坑！</strong></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/25/2017-08-25/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Romance">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/romance.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Romance的修行之路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/25/2017-08-25/" itemprop="url">将项目中公共组件使用Cocoapods管理实战</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-25T17:03:26+08:00">
                2017-08-25
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/25/2017-08-25/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/08/25/2017-08-25/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>想直接操作上手的请略过<strong><a href="#1">前言</a></strong>部分，直接阅读<strong><a href="#2">正文</a></strong>部分；<br>建议不要错过精彩的<strong>前言</strong>哦，或许你看了对你有所启发。</p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a><span id="1">前言</span></h2><p>随着项目的发展，版本迭代，代码的重构，我们项目中一般会有很多有业务功能行性公共的组件，app中可能多处都会使用到，甚至别的项目中也需要使用。比如我们<a href="https://itunes.apple.com/cn/app/励步云学习/id1250682685?mt=8" target="_blank" rel="noopener">FCS</a>项目中有一个语音评测的功能，前期只是在<strong>FCS</strong>项目里面需要用到，后面在另一不同项目<strong>绘本阅读</strong>需要用到相同语音评测的功能。此时我们一般有两种做法，<strong>一是直接将这部分代码copy到绘本阅读这个项目中</strong>；<strong>二是将语音评测这部分逻辑给抽取出来，然后在分别在两处使用</strong>。很明显在项目初期，或者时间紧迫的情况下，第一种方式很好的能够胜任工作，我们前期也是这么做的，但是我发现到了随着项目的推移和发展，这样做的时间成本太大了，效率也很低下，有很多隐患(评测逻辑一旦有变动，你需要改动两次，而且你没法保证两次的改动一致)。<strong>正确的做法是在适当的时间应该立马进行代码重构，将这部分重复的代码给抽取出来。至于重构的准则就是</strong>三次法则<strong>，出自Martin Fowler《重构改善既有代码的设计》</strong>，这本书真的推荐大家一看，程序员必读的书籍之一。扯远了。。。</p>
<p>于是我花了几天时间将语音评测这部分逻辑给抽取出来，建立了一个公共组件<strong><code>SpeechEvaluationKit</code></strong>，在两个项目中都能够方便的使用，并且使用Cocoapods来管理。公司项目的核心代码存放在<a href="https://mart.coding.net/" target="_blank" rel="noopener">Coding</a>上，包括<strong><code>SpeechEvaluationKit</code></strong>的代码，这部分代码我们是不能够公开的，所以我建立的是<strong>私有库(Private Pods)</strong>，也是本文实战操作所建立私有库管理；相对应的当然就有<strong>公有库</strong>，这部分的代码不仅可以自己使用，还可以开源出来。</p>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a><span id="2">正文</span></h2><p>关于CocoaPods的介绍、安装、使用说明请查看<a href="https://guides.cocoapods.org/using/getting-started.html" target="_blank" rel="noopener">官方文档</a>，同时本文的操作也是根据官方文档介绍来完成的。<br>如下图，项目的目录结构如下图：<br><img src="http://upload-images.jianshu.io/upload_images/1603505-6ea03a96547a65ad.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3 id="新建-项目名-podspec"><a href="#新建-项目名-podspec" class="headerlink" title="新建[项目名].podspec"></a>新建<strong>[项目名].podspec</strong></h3><p>使用命令：<code>pod spec create &#39;项目名&#39;</code>、<code>pod lib create &#39;项目名&#39;</code>。<br>现有的项目，在项目根目录运行终端命令：<code>pod spec create &#39;SpeechEvaluationKit&#39;</code>，根目录下将会生成一<code>SpeechEvaluationKit.podspec</code>文件。<br><img src="http://upload-images.jianshu.io/upload_images/1603505-2f7fdc4495c7cedd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>如果还没有创建项目，则使用<code>pod lib create &#39;SpeechEvaluationKit&#39;</code>，这一步会让你填写一些信息比如使用swift还是oc、是否使用测试框架等等，我的选择如下：<br><img src="http://upload-images.jianshu.io/upload_images/1603505-3e9751d48453d14a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>最终生成的的目录如下，<strong>新建项目写完代码后得将本地仓库添加到远程git仓库</strong>，关联命令为<code>git remote add origin 远程仓库地址</code><br><img src="http://upload-images.jianshu.io/upload_images/1603505-6133a667550c402c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3 id="配置podspec文件"><a href="#配置podspec文件" class="headerlink" title="配置podspec文件"></a>配置podspec文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Pod::Spec.new do |s|</span><br><span class="line">  s.name             = &apos;SpeechEvaluationKit&apos;</span><br><span class="line">  s.version          = &apos;1.0.0&apos;</span><br><span class="line">  s.summary          = &apos;SpeechEvaluationKit is a powerful voice evaluation library&apos;</span><br><span class="line">  s.description      = &apos;A powerful voice evaluation library，such as book reading, living and ips mission.&apos;</span><br><span class="line">  s.homepage         = &apos;https://git.coding.net/firstleap/SpeechEvaluation_iOS.git&apos;</span><br><span class="line">  s.license          = &#123; :type =&gt; &apos;MIT&apos;, :file =&gt; &apos;LICENSE&apos; &#125;</span><br><span class="line">  s.author           = &#123; &apos;XcqRomance&apos; =&gt; &apos;xcqromance@163.com&apos; &#125;</span><br><span class="line">  s.source           = &#123; :git =&gt; &apos;https://git.coding.net/firstleap/SpeechEvaluation_iOS.git&apos;, :tag =&gt; s.version.to_s &#125;</span><br><span class="line">  s.ios.deployment_target = &apos;8.0&apos;</span><br><span class="line">  s.source_files     = &apos;SpeechEvaluationKit/Classes/**/*&apos;</span><br><span class="line">  s.exclude_files    = &quot;SpeechEvaluationKit/Assets/**&quot;`</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>这个podspec文件包含的信息很重要，对于一个普通的pods库上面的信息就足够了，各个配置的含义基本都能够看得懂，比如<code>name</code><br>代表你的pods库的名字，如果是公有pods库，可以通过<code>pod search name</code>来搜索查看；<code>version</code>则代表版本号，一旦库有发布更新就通过修改这个版本号来发布更新；<code>summary</code>和<code>description</code>就是对pods库的简介和详细说明，这个根据库的功能来描述；<code>source</code>一般填写代码仓库地址可以是git、svn、github的地址；<code>source_files</code>代表你这个pods库包含的代码，一般就是我们编写公共组件的代码，文件的描述都是可以用一些匹配公式，比如上面用到的**和*；<code>exclude_files</code>一般是除了代码之外的资源文件，比如图片、音频之类的;至于其他信息，你可以根据自己库的需求来配置，比如YTKNetwork是基于AFNetworking的封装，所以还添加了<code>s.dependency &quot;AFNetworking&quot;, &quot;~&gt; 3.0&quot;</code>依赖。上面的这些信息必须读严谨的配置，否则在下一步验证的时候会出现警告甚至报错不通过。比如我之前的summary没有更改而是使用的模版信息，就出现如下警告：<br><img src="http://upload-images.jianshu.io/upload_images/1603505-2895b3af3a5c611c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3 id="验证podspec文件和项目-pod-lib-lint-Name-podspec"><a href="#验证podspec文件和项目-pod-lib-lint-Name-podspec" class="headerlink" title="验证podspec文件和项目(pod lib lint Name.podspec)"></a>验证podspec文件和项目(<code>pod lib lint Name.podspec</code>)</h3><p>执行命令<code>pod lib lint SpeechEvaluationKit.podspec</code>（后面还可以添加参数<code>--verbosev</code>，有助于出错的问题定位）<br>一般到这一步会遇到很多警告和错误导致验证不通过，此时不要心急，一个一个问题解决，在<a href="https://stackoverflow.com/" target="_blank" rel="noopener">stack overflow</a>寻找解决方案，你所遇到的问题，前人们很多都已经遇到过了。<br>验证通过提示信息如下：<br><img src="http://upload-images.jianshu.io/upload_images/1603505-f72f788dabe83f78.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>一旦验证通过，你就离成功只有一步之遥了；</p>
<h3 id="建立tag，并且上传git仓库，tag版本和podspec文件的version版本保持一致就行了；git-常见命令传送门"><a href="#建立tag，并且上传git仓库，tag版本和podspec文件的version版本保持一致就行了；git-常见命令传送门" class="headerlink" title="建立tag，并且上传git仓库，tag版本和podspec文件的version版本保持一致就行了；git 常见命令传送门"></a>建立tag，并且上传git仓库，tag版本和podspec文件的<code>version</code>版本保持一致就行了；<a href="http://www.jianshu.com/p/1c231a7f8a73" target="_blank" rel="noopener">git 常见命令传送门</a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git tag -a 1.0.0 -m &apos;pod私有仓库&apos;  #打tag</span><br><span class="line">git push origin 1.0.0:1.0.0 #上传tag</span><br></pre></td></tr></table></figure>
<h3 id="发布项目到cocoapods官方仓库"><a href="#发布项目到cocoapods官方仓库" class="headerlink" title="发布项目到cocoapods官方仓库"></a>发布项目到cocoapods官方仓库</h3><p>等等…在这之前你得先有一个Cocoapods账号，也就是得先注册一个账号，执行以下命令：<br><code>pod trunk register romance.xie@firstleap.cn &#39;romance&#39; --description=&#39;My working computer&#39;</code><br>邮箱、名字、描述该为自己的就行，然后你将会邮箱会收到一封邮件，点击右键链接激活，然后通过<code>pod trunk me</code>来查看自己是否注册成功：<br><img src="http://upload-images.jianshu.io/upload_images/1603505-16bfb9e3ba346063.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>如果是多人开发，只需执行命令：<code>pod trunk add-owner &#39;项目名&#39; &#39;邮箱&#39;</code>将伙伴添加到项目中；</p>
<h4 id="公有库的发布-即开源的，会将podspec文件上传到cocoapods官网，当执行pod-install-或者-pod-update的时候会根据配置文件取对应的源代码"><a href="#公有库的发布-即开源的，会将podspec文件上传到cocoapods官网，当执行pod-install-或者-pod-update的时候会根据配置文件取对应的源代码" class="headerlink" title="公有库的发布(即开源的，会将podspec文件上传到cocoapods官网，当执行pod install 或者 pod update的时候会根据配置文件取对应的源代码)"></a><strong>公有库的发布</strong>(即开源的，会将podspec文件上传到cocoapods官网，当执行pod install 或者 pod update的时候会根据配置文件取对应的源代码)</h4><p><strong>发布命令</strong>：<code>pod trunk push 项目名.podspec</code><br>使用<code>pod search 项目名</code>查看是否上传成功，下图是我们app中日志收集的公有库<code>FLogKit</code>，<code>pod search FLogKit</code><br><img src="http://upload-images.jianshu.io/upload_images/1603505-7aff47004f74076a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h4 id="私有库的发布"><a href="#私有库的发布" class="headerlink" title="私有库的发布"></a><strong>私有库的发布</strong></h4><p><strong>发布命令</strong>：<code>pod repo add &#39;仓库名&#39; &#39;仓库地址&#39;</code><br>如果是现有的项目，代码放在coding私有项目中，仓库地址直接填写第2步podspec配置文件的<code>s.source</code>的地址，即执行以下命令即可：<code>pod repo add &#39;SpeechEvaluationKit&#39; &#39;https://git.coding.net/firstleap/SpeechEvaluation_iOS.git&#39;</code>;<br>如果是新建的项目，即第1步中，使用<code>pod lib create &#39;项目名&#39;</code>初始化的项目，就需要先在服务器建立一个私有仓库，我这里以在Coding中建立私有仓库为例，仓库建立好后将会有获得git仓库地址，<br><img src="http://upload-images.jianshu.io/upload_images/1603505-6f6f3dd14ace1ee7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>记得将写好的代码提交到Coding的Git仓库中，执行发布命令<code>pod repo add &#39;SpeechEvaluationKit&#39; &#39;https://git.coding.net/romance/SpeechEvaluationKit.git&#39;</code>;<br><img src="http://upload-images.jianshu.io/upload_images/1603505-970efc4a78878ae2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>使用<code>open ~/.cocoapods/repos</code>查看是否创建好私有仓库，一旦代码有更新，使用<code>pod repo update</code>更新pod私有仓库，删除私有仓库<code>pod repo remove &#39;项目名&#39;</code>。</p>
<h3 id="使用组件"><a href="#使用组件" class="headerlink" title="使用组件"></a>使用组件</h3><p><code>pod &#39;SpeechEvaluationKit&#39;, :path =&gt; &#39;../&#39;</code>，开发模式<br><code>pod &#39;SpeechEvaluationKit&#39;</code>，稳定之后或者其他项目的使用</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>看完本文知道Cocoapods管理公共组件是多么简单了吧，当然里面一些深入的内容需要在实际使用过程中才领悟了解。整个过程及其使用就只有五步：<strong>新建podspec文件-&gt;配置podspec文件-&gt;验证podspec文件和项目-&gt;上传tag-&gt;发布更新</strong>。这步骤你记住了么。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/17/2017-08-17/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Romance">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/romance.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Romance的修行之路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/17/2017-08-17/" itemprop="url">使用TestFlight对iOS app beta版本测试实战</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-17T12:14:07+08:00">
                2017-08-17
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/17/2017-08-17/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/08/17/2017-08-17/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>TestFlight是苹果官方提供给开发者对<strong>预发布版本</strong>进行测试的工具或者说是一种服务。通过本文你将知道如何使用TestFlight添加测试人员以及邀请外部测试人员进行测试。本文参考<a href="https://help.apple.com/itunes-connect/developer/#/devdc42b26b8" target="_blank" rel="noopener">苹果官方提供的方法教程</a></p>
<p>我们知道苹果开发者可以申请的账号有三类<strong>个人、公司、企业</strong>这三大类(其实还有一类就是教育机构，比如大学，但是我们一般用得少，所以不说)<a href="https://developer.apple.com/support/compare-memberships/" target="_blank" rel="noopener">苹果官方定义几大分类传送门</a>，个人、公司开发者账号的会员费99$一年，企业级账号是299$一年。</p>
<p>关于在iOS app测试我们知道由于苹果的安全签名机制，我们开发的app想要对外测试(比如给公司客户、领导等等)并不是一件容易的事情。对于企业级账号我们可以之间让用户下载，信任之后直接使用，但是这类app并不能发布到App Store，所以也就无法进行本文所说的TestFlight Beta Testing功能，一般是企业内部使用的app才会选择。对于大部分互联网公司，肯定是选择<strong>公司级别的账号</strong>，最终需要发布到App Store的，而这类账户的测试就很麻烦，有100台设备限制，而且还得事先获取设备UDID，然后导出ipa，链接itunes安装，总之整个流程下来特别繁琐。当然还有一种是简便方式就是通过第三方的分发平台，比如蒲公英，TestBird；但这不在我们的讨论范围之内。</p>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p><strong>注意：本文的操作都所使用的开发者账号是前言部分说的第二种：99$的Appstore公司开发者账号</strong></p>
<h3 id="提前准备的工作：有手动打包或者自动打包构建好的好的ipa文件。如下图"><a href="#提前准备的工作：有手动打包或者自动打包构建好的好的ipa文件。如下图" class="headerlink" title="提前准备的工作：有手动打包或者自动打包构建好的好的ipa文件。如下图"></a>提前准备的工作：有手动打包或者自动打包构建好的好的ipa文件。如下图</h3><p><img src="http://upload-images.jianshu.io/upload_images/1603505-b17159f62be469ca.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="导出的ipa"></p>
<h3 id="使用Application-Loader上传构建版本到iTunes"><a href="#使用Application-Loader上传构建版本到iTunes" class="headerlink" title="使用Application Loader上传构建版本到iTunes"></a>使用Application Loader上传构建版本到iTunes</h3><p>具体操作如下：<br>Xocode-&gt;Open Developer Tool-&gt;Application Loader<br><img src="http://upload-images.jianshu.io/upload_images/1603505-0220ec1d8e114cd1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="open"><br>登录apple ID账号<br><img src="http://upload-images.jianshu.io/upload_images/1603505-6eeddb261b58046c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="login"><br>双击上图箭头指向的框框，选取提交的构建版本<br><img src="http://upload-images.jianshu.io/upload_images/1603505-7337655202943e17.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="submit"><br>根据操作一直下一步，直到成功<br><img src="http://upload-images.jianshu.io/upload_images/1603505-fc6e28fee4b047d3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="submit2"><br>登录<a href="https://itunesconnect.apple.com/login" target="_blank" rel="noopener">iTunes Connect</a>可以查看提交的构建版本<br><img src="http://upload-images.jianshu.io/upload_images/1603505-d151e7d1bd3d1a4d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="success"></p>
<ul>
<li>如果开发团队人员多，建议使用<a href="https://jenkins.io" target="_blank" rel="noopener">Jenkins</a>+<a href="https://fastlane.tools" target="_blank" rel="noopener">Fastlane</a>进行持续集成，只需要在一台mac电脑进行配置证书之类的，整个团队都可以打包并且自动上传到Appstore，供测试人员下载测试，大大提高整个团队的开发效率；具体配置很简单，网络上有很多教程！（Android的持续集成也支持哟）</li>
</ul>
<h3 id="创建和添加测试人员"><a href="#创建和添加测试人员" class="headerlink" title="创建和添加测试人员"></a>创建和添加测试人员</h3><p>你可以在Test Flight中添加两种类型的测试；<br><strong>内部测试</strong>：<strong>管理员，技术，app管理员，开发人员和营销</strong>角色的iTunes Connect用户，这些角色可以访问我们的应用程序。 这通常是您正在开发应用程序的团队成员或客户端。 最多可以添加25个内部测试人员。<a href="https://help.apple.com/itunes-connect/developer/#/dev839fb66e9" target="_blank" rel="noopener">苹果官方定义内部测试</a></p>
<p><strong>外部测试</strong>：外部测试员可以是任何拥有一个电子邮件地址的用户，应邀为我们的 App 进行 Beta 版测试。外部测试员中可以包括 iTunes Connect 用户，但 iTunes Connect 用户不能同时为内部和外部测试员。而且至多 能添加10,000 个外部测试员。<a href="https://help.apple.com/itunes-connect/developer/#/deved4d898a5" target="_blank" rel="noopener">苹果官方定义外部测试</a></p>
<h3 id="添加内部测试人员"><a href="#添加内部测试人员" class="headerlink" title="添加内部测试人员"></a>添加内部测试人员</h3><p>登录iTunes Connect按照如下步骤进行设置<br><img src="http://upload-images.jianshu.io/upload_images/1603505-bce37c3dda60632b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="内部测试人员"><br>各个角色对应的权限如下图：<br><img src="http://upload-images.jianshu.io/upload_images/1603505-74aa8eb112b2a2f9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="角色权限"><br>这里我选择的角色是<strong>App 管理</strong>，还可以选择测试的app，我们公司账号有多个app，所以我选择<strong>所有app</strong><br>点击下图的存储，<br><img src="http://upload-images.jianshu.io/upload_images/1603505-8cb2ec2a4bb9de9a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="save"><br><img src="http://upload-images.jianshu.io/upload_images/1603505-606995c51420d3f0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="success"><br>查看自己的邮件验证，activate your account，至此添加测试人员完毕。<br><img src="http://upload-images.jianshu.io/upload_images/1603505-5ceca8679632f08a.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="email"></p>
<h3 id="TestFlight添加测试员"><a href="#TestFlight添加测试员" class="headerlink" title="TestFlight添加测试员"></a>TestFlight添加测试员</h3><p>进入iTunes Connect 主页点击<strong>我的 App</strong>，选择<strong>TestFlight</strong>模块，选择要进行测试的构建版本；然后在左边<strong>iTunes Connect 用户</strong>一栏将上一步的测试员(    romance.xie@100tal.com)添加进来，如下图：<br><img src="http://upload-images.jianshu.io/upload_images/1603505-dcbba8e85473f9ed.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="添加用户"><br><img src="http://upload-images.jianshu.io/upload_images/1603505-841ed4daf554eae6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="成功添加"></p>
<h3 id="添加外部测试人员"><a href="#添加外部测试人员" class="headerlink" title="添加外部测试人员"></a>添加外部测试人员</h3><ol>
<li>新建一个群组命名为<strong>外部测试人员</strong>；<br><img src="http://upload-images.jianshu.io/upload_images/1603505-dbc2c9249824c975.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="新建群组"></li>
<li>添加测试员，有三种方式：<strong>添加新测试员、添加现有测试人员、从CSV导入</strong>；<br><img src="http://upload-images.jianshu.io/upload_images/1603505-1e27a2ec151c62f6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="添加测试员"><br>我这里选择第一种添加新测试员，输入信息后点击添加<br><img src="http://upload-images.jianshu.io/upload_images/1603505-cc8fcbfafd8bf970.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="下一步"><br><img src="http://upload-images.jianshu.io/upload_images/1603505-b4e11144fed4a543.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="添加信息"></li>
<li><strong>添加构建版本</strong>(这也是内部和外部测试人员的不同之处，用来区分内部和外部测试人员测试不同的版本)<br><img src="http://upload-images.jianshu.io/upload_images/1603505-354c8040e9ad22c7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="外部测试添加构建版本"><br>需要注意的是添加的构建版本需要通过Beta版App审核(第一次提交需要2天左右，之后提交会变得很快)；<br><img src="http://upload-images.jianshu.io/upload_images/1603505-e34c8e8cde0e2434.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="选择构建版本"><br><img src="http://upload-images.jianshu.io/upload_images/1603505-8b17004abc55e79e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="填写测试信息1"><br><img src="http://upload-images.jianshu.io/upload_images/1603505-b584fabf0c0319ec.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="填写测试信息2"></li>
</ol>
<p>然后你的外部测试人员的邮件将会收到邀请码</p>
<h3 id="测试Beta-app"><a href="#测试Beta-app" class="headerlink" title="测试Beta app"></a>测试Beta app</h3><ol>
<li>安装TestFlight App<br>在App Store中搜索TestFlight，安装</li>
<li>当新的测试版本上传到iTunes Connect时，<strong>内部测试人员</strong>将自动收到电子邮件。 如果测试版本app通过Beta App 审核后，<strong>外部测试人员</strong>将收到类似的电子邮件，并且该版本已被iTunes Connect中的管理员或应用程序管理员推送到外部测试人员：</li>
<li>在需要测试的设备中打开邮件内容，下面两图是内部测试人员的收到的邮件内容（在添加测试员中的状态下面有个蓝色发送邀请按钮，内部测试人员就会收到邮件了）<br><img src="http://upload-images.jianshu.io/upload_images/1603505-96331586f642288f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="内部测试发送邀请"><br><img src="http://upload-images.jianshu.io/upload_images/1603505-8638c5486b0e7606.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="内部测试邮件内容1"><br><img src="http://upload-images.jianshu.io/upload_images/1603505-bef8cac173c9557e.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="内部测试邮件内容2"><br>外部测试的操作也类似，这里不在赘述。</li>
<li>点击上图的蓝色字体打开<strong>TestFlight</strong>app，就可以安装测试app了，当有新的构建版本是，你将会受到通知，只需更新到最新版本就可以测试。<br><img src="http://upload-images.jianshu.io/upload_images/1603505-f73fdccf18fd082c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="TestFlight"></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/13/2017-07-13/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Romance">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/romance.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Romance的修行之路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/13/2017-07-13/" itemprop="url">app上线后iOS8系统踩过的坑</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-13T11:12:35+08:00">
                2017-07-13
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/07/13/2017-07-13/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/07/13/2017-07-13/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>项目上线，app最低支持的系统版本是iOS8.0，而我们公司的有一些用户还是使用iOS8的系统一直没有升级，而我们公司没有iOS8的测试机（之前有最后都被升级了）。所以项目上线后用户反馈和Bugly统计了大量的crash日志信息。现在集中记录下有iOS8导致的crash，让后人以免踩坑。</p>
<h2 id="iOS8-Crash总结"><a href="#iOS8-Crash总结" class="headerlink" title="iOS8 Crash总结"></a>iOS8 Crash总结</h2><ol>
<li><p><strong>项目使用Carthage集成的第三方库YTKNetwork.framework在iOS8系统设备上启动就闪退</strong>，闪退信息如下：<br><img src="http://upload-images.jianshu.io/upload_images/1603505-92b30315c9e671de.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="YTKNetwork的crash"><br>在GitHub的YTKNetwork下面的issues提问还是没能解决，讨论说是使用Carthage集成就是会存在这么个问题，最后只好将这个库里<code>YTKNetworkAgent.m</code>类中的源码相关<code>requestPriority</code>的部分注释掉才给解决的！<br><img src="http://upload-images.jianshu.io/upload_images/1603505-dc0b3701eb501ac9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="解决方案"></p>
</li>
<li><p><strong>iOS8系统使用的自提示Helvetica，iOS9系统中文系统字体变为了平方<code>(PingFangSC)</code>字体，导致在iOS设备上使用此方法时<code>UIFont *font = [UIFont fontWithName:@&quot;PingFangSC-Medium&quot; size:17]</code>的<code>font</code>为空，</strong>进而导致使用这么使用时<code>@{NSFontAttributeName: font}</code>会crash，信息如下：<br><img src="http://upload-images.jianshu.io/upload_images/1603505-791ee0bf17205e6a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="font crash"><br>但是如果使用swift的写法就安全多了，我们可以知道<code>let font = UIFont(name: &quot;PingFangSC-Medium&quot;, size: 17)</code>中的<code>font</code>这是个<code>optional</code>值可能为空，我可以给一个默认值。Objective-C解决crash的方案有两种：一是使用先判断是否为<code>nil</code>；二是使用<code>[NSDictionary dictionaryWithObjectsAndKeys:font, NSFontAttributeName, nil];</code>。<br>而且，<strong>iOS8系统字体间隙变大导致 UI 显示异常，平方字体比Helvetica字体有轻微的加粗效果，字体间距也变大了，</strong>，所以布局方面一些UILabel写死width的就会有问题，解决方案是计算label 的size并且向上取整ceilf(),</p>
</li>
<li><p><strong>iOS8中单例中的UIKit类中使用<code>addTarget(_ target: Any?, action: Selector, for controlEvents: UIControlEvents)</code>添加的action事件，并不会随着控制器而销毁，导致第二次并不会执行二是直接crash。<a href="https://github.com/XcqRomance/ios8-CrashDemo.git" target="_blank" rel="noopener">GitHub demo地址</a>，ios8模拟器运行效果如下，但是在iOS9+中运行是没有问题的，它对应action会执行两次。<br><img src="http://upload-images.jianshu.io/upload_images/1603505-b85cd2c7765e4794.gif?imageMogr2/auto-orient/strip" alt="crash.gif"></strong><br>这也从另一方面说明单例模式不能够滥用，因为他是常驻内存的，只有当app杀死的时候才能够被释放。我们app用户使用时crash就是因为我们代码写的很不严谨，本不需要使用单例模式却使用了单例模式！</p>
</li>
<li><p><strong>iOS8执行某一个动画时直接crash，并且crash信息如下：<code>&#39;-[CIContext initWithOptions:]: unrecognized selector sent to instance 0x18961850&#39;</code><br>搜索<a href="https://stackoverflow.com/questions/39570644/cicontext-initwithoptions-unrecognized-selector-sent-to-instance-0x170400960" target="_blank" rel="noopener">stackoverflow的解答</a>找到原因是swift的<code>let ciContext = CIContext(options: nil)</code>的原因导致的，最后写了个OC的分类给解决了。另一个解决方案是针对iOS8的系统就不执行动画</strong></p>
</li>
<li><p><strong>iOS8 UITableView crash的信息 Attempt to create two animations for cell</strong>，解决方案：<a href="https://stackoverflow.com/questions/6438606/ios-uitableview-attempt-to-create-two-animations-for-cell" target="_blank" rel="noopener">stackoverflow的回答</a></p>
</li>
</ol>
<h2 id="以下是上传到AppStore所遇到的问题"><a href="#以下是上传到AppStore所遇到的问题" class="headerlink" title="以下是上传到AppStore所遇到的问题"></a>以下是上传到AppStore所遇到的问题</h2><ol>
<li><strong>使用Application Loader交付应用时，报如下错误。原因：打包build号没有修改，</strong>这个最好写个打包自动修改build号的脚本，人工打包很容易忘记修改build号，脚本自行网上搜索；<br><img src="http://upload-images.jianshu.io/upload_images/1603505-0c023eeca5abe8f5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="F30AC746-D254-4419-9603-D2943D29C1A2.png"></li>
</ol>
<p>2.<strong> 使用Application Loader交付应用时，报如下错误信息。原因：使用的一些第三方库如：<code>MJRefresh.framework、SwiftyJSON.framework</code>包含有不支持上线的 <code>x86_64、i386</code>架构；</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ERROR ITMS-90087: &quot;Unsupported Architectures. The executable for leapParent.app/Frameworks/MJRefresh.framework contains unsupported architectures &apos;[x86_64, i386]&apos;.&quot;</span><br><span class="line">ERROR ITMS-90087: &quot;Unsupported Architectures. The executable for leapParent.app/Frameworks/Pulsator.framework contains unsupported architectures &apos;[x86_64, i386]&apos;.&quot;</span><br><span class="line">ERROR ITMS-90087: &quot;Unsupported Architectures. The executable for leapParent.app/Frameworks/SnapKit.framework contains unsupported architectures &apos;[x86_64, i386]&apos;.&quot;</span><br><span class="line">ERROR ITMS-90087: &quot;Unsupported Architectures. The executable for leapParent.app/Frameworks/SwiftyJSON.framework contains unsupported architectures &apos;[x86_64, i386]’.&quot;</span><br></pre></td></tr></table></figure></p>
<p>解决方案：<a href="http://ikennd.ac/blog/2015/02/stripping-unwanted-architectures-from-dynamic-libraries-in-xcode/" target="_blank" rel="noopener">添加去除<code>x86_64、i386</code>架构的脚本</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/29/2017-05-29/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Romance">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/romance.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Romance的修行之路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/29/2017-05-29/" itemprop="url">深入理解iOS设计模式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-29T21:26:13+08:00">
                2017-05-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/05/29/2017-05-29/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/05/29/2017-05-29/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>做 iOS开发也好几年了，记得自己刚入行时，对iOS 开发模式也是一知半解，后面项目做多了，以及看一些优秀书籍之后对他有了进一步的理解；发现自己写的代码中无形之中就用了很多的设计模式，只不过是不知道相应的设计模式术语而已，所以决定把自己做的项目中的一个小模块来写一篇iOS设计模式的文章，一是记录自己的学习；二是让入门者可以作为参考，来理解iOS设计模式。<strong>设计模式是软件设计中常见问题的可重复使用的解决方案。 它们是旨在帮助您编写易于理解和重用的代码的模板。 它们还可以帮助您创建松散耦合的代码，以便您可以在代码中更改或替换组件，而不必太麻烦。</strong>本文将通过一个小项目的形式来讲解iOS的设计模式。通过跟着我一步一步操作你将学到：<strong>什么是设计模式；为什么要使用设计模式；以及怎样在自己的项目中使用合适的设计模式。</strong><br>设计模式分为三大类：</p>
<ol>
<li>构造模式:单例模式(Singleton)，抽象工厂模式(Abstract Factory)等等；</li>
<li>结构模式:MVC，适配器模式(Adapter)，外观模式(Facade)，装饰模式(Decorator)等等；</li>
<li>行为模式:观察者(Observer)，备忘录(Memento)，命令模式(Command)。<br>整个项目完成将会是如下效果图：<br><img src="http://upload-images.jianshu.io/upload_images/1603505-7c801b4694a50545.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></li>
</ol>
<h2 id="开始鲁代码"><a href="#开始鲁代码" class="headerlink" title="开始鲁代码"></a>开始鲁代码</h2><p>github上下载<a href="https://github.com/XcqRomance/BookRoom.git" target="_blank" rel="noopener">starter project</a>，使用Xcode打开项目，这是一个新建的空项目，我将Main.storyboard给删除了，在appdelegate中使用代码设置window的rootViewController为ViewController；以及将books.json放入到了本地，模拟网络请求来的书籍数据(这部分涉及到公司的机密资源，所以只能这样模拟)。</p>
<p>1、使用快捷键Command+N，选择iOS-&gt;Swift File，并且命名为<code>Book</code>,新建一个<code>Book</code>结构体作为模型，并且编写如下代码。(在Objective-C我们一般是新建一个<code>Book</code>类作为模型，但是swift中官方推荐使用结构体，更加轻量级)，此处我使用了<a href="https://github.com/Ahmed-Ali/JSONExport" target="_blank" rel="noopener">JSONExport</a>开源工具生成Book结构体，这是一个很强大的将json转化模型的Mac桌面应用。<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">var</span> bid: <span class="type">Int</span>!</span><br><span class="line">  <span class="keyword">var</span> bookName: <span class="type">String</span>!</span><br><span class="line">  <span class="keyword">var</span> isRead: <span class="type">Bool</span>!</span><br><span class="line">  <span class="keyword">var</span> orientation: <span class="type">Int</span>!</span><br><span class="line">  <span class="keyword">var</span> pic: <span class="type">String</span>!</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Instantiate the instance using the passed dictionary values to set the properties values</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">init</span>(fromDictionary dictionary: [<span class="type">String</span>: <span class="type">Any</span>])&#123;</span><br><span class="line">    bid = dictionary[<span class="string">"bid"</span>] <span class="keyword">as</span>? <span class="type">Int</span></span><br><span class="line">    bookName = dictionary[<span class="string">"book_name"</span>] <span class="keyword">as</span>? <span class="type">String</span></span><br><span class="line">    isRead = dictionary[<span class="string">"is_read"</span>] <span class="keyword">as</span>? <span class="type">Bool</span></span><br><span class="line">    orientation = dictionary[<span class="string">"orientation"</span>] <span class="keyword">as</span>? <span class="type">Int</span></span><br><span class="line">    pic = dictionary[<span class="string">"pic"</span>] <span class="keyword">as</span>? <span class="type">String</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Returns all the available property values in the form of [String:Any] object where the key is the approperiate json key and the value is the value of the corresponding property</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">toDictionary</span><span class="params">()</span></span> -&gt; [<span class="type">String</span>:<span class="type">Any</span>]</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> dictionary = [<span class="type">String</span>: <span class="type">Any</span>]()</span><br><span class="line">    <span class="keyword">if</span> bid != <span class="literal">nil</span>&#123;</span><br><span class="line">      dictionary[<span class="string">"bid"</span>] = bid</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> bookName != <span class="literal">nil</span>&#123;</span><br><span class="line">      dictionary[<span class="string">"book_name"</span>] = bookName</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> isRead != <span class="literal">nil</span>&#123;</span><br><span class="line">      dictionary[<span class="string">"is_read"</span>] = isRead</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> orientation != <span class="literal">nil</span>&#123;</span><br><span class="line">      dictionary[<span class="string">"orientation"</span>] = orientation</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> pic != <span class="literal">nil</span>&#123;</span><br><span class="line">      dictionary[<span class="string">"pic"</span>] = pic</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dictionary</span><br><span class="line">  &#125;</span><br><span class="line">		</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>当然在实际项目中swift的json解析我们还可以使用GitHub开源的<a href="https://github.com/SwiftyJSON/SwiftyJSON" target="_blank" rel="noopener">SwiftyJSON</a>，这个也很好用，使用这个就能够减少model类的创建，这个两种使用方式各有各的好吧。</p>
<p>2、Command + N,选择Cocoa Touch Class，命名为<code>BookView</code>作为<code>UICollectionView</code>的子类，language选择Swift；同样操作新建一个<code>BookCell</code>作为<code>UICollectionViewCell</code>的子类，在选择language上面勾选Also create XIB file。新建完毕之后记得在这两个类前面添加<code>final</code>修饰符(这里涉及到代码规范的内容，我后续将会写一篇这样的文章，苹果官方推荐那些些不会继承的类可以添加final修饰，这么做的好处是提高编译速度，当项目庞大的时候优势就明显了，我也深有体会)</p>
<h2 id="MVC设计模式"><a href="#MVC设计模式" class="headerlink" title="MVC设计模式"></a>MVC设计模式</h2><p>Model View Controller(模型视图控制器)是我们所有设计模式中最常用的，他根据程序中的角色对对象进行分类，使代码干净分离，低耦合；<br><strong>Model：</strong>保存程序的数据并且定义如何操作它的对象。本例子的Model是结构体<code>Book</code>；<br><strong>View：</strong>负责程序UI视觉元素的表示以及与用户的交互响应，基本上所有的UIView及其子类都属于这一类；本例中的View是<code>BookView</code>；<br><strong>Controller：</strong>控制器是View和Model之间的协调者，它访问模型中的数据，并且显示于视图，并且监听用户事件并根据需要操作数据；本例中的Controller是<code>ViewController</code><br>下图很好的显示了这三者之间的关系：<br><img src="http://upload-images.jianshu.io/upload_images/1603505-47b5ad94ed4f1bb9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="MVC"></p>
<ol>
<li>模型数据的变化会通知通知控制器，同时控制器就会更新视图上的数据；</li>
<li>当用户有操作交互时，视图也能通知控制器，于是控制器更新模型中的数据信息。<br>有些人就会有疑问了，为什么不把所有的都写在一个类里面，直接在将视图和模型都写在控制器里面，这样操作起来很容易。<br>我们都知道软件设计有个很重要的原则就是：<strong>高内聚，低耦合</strong>，所以我们得考虑把代码分离和重用。理想情况下，视图应与模型完全分开。 如果View不依赖于Model的具体实现，则可以使用不同的模型重用其他数据。例如本例中的模型Book，因为不依赖任何视图类，所以可以很简单的重复使用。以及视图类BookView和BookCell，在将来要添加某个功能时完全可以复用，例如我做的真实项目中有个功能模块是书籍的本地下载页面，此时就完全可以复用整个视图类。</li>
</ol>
<p>基于MVC，我将项目程序分为了三个group，使用快捷键Command+option+N新建三个group，并且命名为Model、View、Controller，同时将相应的源文件拖入相应的分组，如下图：<br><img src="http://upload-images.jianshu.io/upload_images/1603505-15e61730e6a6e3c8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="group分组"></p>
<h2 id="单例模式-The-Singleton-Pattern"><a href="#单例模式-The-Singleton-Pattern" class="headerlink" title="单例模式(The Singleton Pattern)"></a>单例模式(The Singleton Pattern)</h2><p>单例模式能够确保指定类只有一个实例，并且全局可以访问到该实例。苹果官方有大量使用这个模式，比如：<code>UserDefaults.standard、UIApplication.shared、UIScreen.main</code>等等，但是，<strong>单例也不能够滥用，因为单例一旦创建他的内存将存在于整个应用程序的一生，直到应用程序被关闭，内存才被释放</strong>。本例中：BookAPI类是单例用来处理书籍数据<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">BookAPI</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> persistencyManager: <span class="type">PersistencyManager</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> httpClient: <span class="type">HTTPClient</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">/// 单例</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">let</span> sharedInstance = <span class="type">BookAPI</span>()</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">override</span> <span class="keyword">init</span>() &#123; <span class="comment">// 线程安全</span></span><br><span class="line">    persistencyManager = <span class="type">PersistencyManager</span>()</span><br><span class="line">    httpClient = <span class="type">HTTPClient</span>()</span><br><span class="line">    <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/// 返回书籍数量</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Returns: book数组</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">getBooks</span><span class="params">()</span></span> -&gt; [<span class="type">Book</span>] &#123;</span><br><span class="line">    <span class="keyword">return</span> persistencyManager.books</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/// 保存书籍数据</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">saveBooks</span><span class="params">()</span></span> &#123;</span><br><span class="line">    persistencyManager.saveBooks()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="comment">/// 删除指定位置的绘本</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Parameter index: index 0</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">deleteBookAt</span><span class="params">(index: Int)</span></span> &#123;</span><br><span class="line">    httpClient.postRequest(url: <span class="string">"delete/book"</span>, params: [<span class="string">"book_id"</span>: <span class="string">""</span>]) &#123; (res) <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">if</span> res &#123; <span class="comment">// 服务器删除成功,删除本地的绘本</span></span><br><span class="line">        persistencyManager.deleteBookAt(index: index)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"删除绘本失败，请稍后再试"</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="外观模式-The-Facade-Pattern"><a href="#外观模式-The-Facade-Pattern" class="headerlink" title="外观模式(The Facade Pattern)"></a>外观模式(The Facade Pattern)</h2><p><img src="http://upload-images.jianshu.io/upload_images/1603505-736a238586babc2e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="外观模式的形象例子"></p>
<p><strong>外观设计模式为复杂的子系统提供单一的接口，只公开一个简单统一的API，而不是将一组类及其API暴露给用户。</strong><br><img src="http://upload-images.jianshu.io/upload_images/1603505-c28bb0767eb32694.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Facade Pattern"><br>API的用户完全不知道下面的复杂性。 这种模式在使用大量类时非常理想，特别是当它们复杂使用或难以理解时。<br>外观模式将使用系统的代码与您隐藏的类的接口和实现相分离; 它也减少了外部代码对子系统内部工作的依赖性。 如果外观下面的类改变，那么外部类可以保留相同的API。<br>例如，如果您希望替换后台服务器地址，您将不必更改您的API的代码。<br>在本例中如何使用外观设计模式：<br>目前我们有<code>PersistencyManager</code>来获取本地书籍数据，保存书籍数据；<code>HTTPClient</code>来处理网络请求。我们项目中的其他类将不会知道这个底层逻辑。<br>如下图我们将在<code>BookAPI</code>暴露以下方法来供外部调用：<br><img src="http://upload-images.jianshu.io/upload_images/1603505-ebab5c0fceb71293.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="公共方法"><br>而<code>persistencyManager、httpClient</code>为<code>BookAPI</code>的私有成员变量，不暴露给外部调用；<br><img src="http://upload-images.jianshu.io/upload_images/1603505-a09687342e22ef07.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="私有成员变量"></p>
<h2 id="装饰设计模式-The-Decorator-Design-Patte"><a href="#装饰设计模式-The-Decorator-Design-Patte" class="headerlink" title="装饰设计模式(The Decorator Design Patte)"></a>装饰设计模式(The Decorator Design Patte)</h2><p><img src="http://upload-images.jianshu.io/upload_images/1603505-b9a1a108c48cd94a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="装饰模式的形象例子"><br>装饰设计模式可以在不修改其代码的情况下，动态地向对象添加行为和责任。 就扩展功能来说，装饰设计模式相比于生成子类更为灵活。<br>在Objective-C中，这种模式有两种非常常见的实现：<strong>Category(类别)和Delegation(委派)</strong>。swift中使用<strong>extension</strong>为相应的类添加扩展。<br>以下三种情况考虑使用这一模式：</p>
<ol>
<li>想要在不影响其他对象的情况下，移动台、透明的方式给单个对象添加职责；</li>
<li>想要扩张一个类的行为，却做不到。类定义可能被隐藏，无法进行子类话；或者对类的每个行为的扩展，为支持美中功能组合，将产生大量的子类；</li>
<li>对类的职责的扩展是可选的。</li>
</ol>
<h2 id="extension"><a href="#extension" class="headerlink" title="extension"></a>extension</h2><p>本例中的book封面，后台返回的字段<code>&quot;pic&quot;: &quot;/image/20160826/d51285bb636281dce6974313eaf6f15d.png&quot;</code>只是一个路径，前面的域名<code>https://xxxxxx-aliyun.firstleap.cn</code>需要我们这边统一拼接，同时我们使用的阿里云存储服务，有对图片进行处理（包括图片压缩，减少图片分辨率），且iPhone和iPad的处理还不一样。</p>
<p>我们对String添加一个扩展(oc中为category)，File/New/File…,选择Swift File，命名为<code>String+Aliyun</code>，添加以下代码：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断型号</span></span><br><span class="line"><span class="keyword">let</span> isPad = ( <span class="type">UI_USER_INTERFACE_IDIOM</span>() == .pad)</span><br><span class="line"><span class="keyword">let</span> fileHost = <span class="string">"https://xxxxxx-aliyun.firstleap.cn"</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">String</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">aliyunThumb</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> isPad &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"<span class="subst">\(fileHost)</span><span class="subst">\(<span class="keyword">self</span>)</span>"</span> + <span class="string">"!iPadThumb"</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"<span class="subst">\(fileHost)</span><span class="subst">\(<span class="keyword">self</span>)</span>"</span> + <span class="string">"!thumb"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Delegation"><a href="#Delegation" class="headerlink" title="Delegation"></a>Delegation</h2><p>本例中的BookView作为UICollectionView的子类，有两个方法你必须实现，那就是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 有多少个item</span><br><span class="line">public func collectionView(_ collectionView: UICollectionView, numberOfItemsInSection section: Int) -&gt; Int</span><br><span class="line">// 每个item需要现实的信息内容</span><br><span class="line">public func collectionView(_ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -&gt; UICollectionViewCell</span><br></pre></td></tr></table></figure></p>
<p>这两个方法都是有BookView的代理ViewController中实现，苹果的UIKit中有很多都是代理委托模式（<code>UITableView, UITextView, UITextField, UIWebView, UIAlert, UIActionSheet, UICollectionView, UIPickerView, UIGestureRecognizer, UIScrollView</code>）</p>
<p>ViewController中实现BookView的代理方法如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">extension ViewController: UICollectionViewDataSource, UICollectionViewDelegate &#123;</span><br><span class="line">func collectionView(_ collectionView: UICollectionView, numberOfItemsInSection section: Int) -&gt; Int &#123;</span><br><span class="line">      return books.count</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  func collectionView(_ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -&gt; UICollectionViewCell &#123;</span><br><span class="line">    let cell = collectionView.dequeueReusableCell(withReuseIdentifier: &quot;BookCell&quot;, for: indexPath) as! BookCell</span><br><span class="line">    if indexPath.item &gt; books.count - 1  &#123;</span><br><span class="line">      cell.coverName.isHidden = true</span><br><span class="line">      cell.bookCover.isHidden = true</span><br><span class="line">      cell.isReadImageView.isHidden = true</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      cell.coverName.isHidden = false</span><br><span class="line">      cell.bookCover.isHidden = false</span><br><span class="line">      cell.isReadImageView.isHidden = false</span><br><span class="line">      cell.book = books[indexPath.item]</span><br><span class="line">    &#125;</span><br><span class="line">    return cell</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  func collectionView(_ collectionView: UICollectionView, didSelectItemAt indexPath: IndexPath) &#123;</span><br><span class="line">    let alertVc = UIAlertController(title: &quot;要删除这本绘本么&quot;, message: &quot;&quot;, preferredStyle: .alert)</span><br><span class="line">    let sureAction = UIAlertAction(title: &quot;确定删除&quot;, style: .default, handler: &#123; (_) in</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">    alertVc.addAction(sureAction)</span><br><span class="line">    let cancelAction = UIAlertAction(title: &quot;取消&quot;, style: .default, handler: nil)</span><br><span class="line">    alertVc.addAction(cancelAction)</span><br><span class="line">    present(alertVc, animated: true, completion: nil)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="备忘录模式-The-Memento-Pattern"><a href="#备忘录模式-The-Memento-Pattern" class="headerlink" title="备忘录模式(The Memento Pattern)"></a>备忘录模式(The Memento Pattern)</h2><p>顾名思义，备忘录模式用来保存当前程序退出时，当前上下文的文档的数据；<br><strong>在不破坏封装的前提下，捕获一个对象的内部状态，并在该对象之外保存这个状态，这样以后就可以将该对象恢复到原先的保存状态。</strong><br>当满足以下两个条件时需要考虑使用这一模式：</p>
<ol>
<li>需要保存一个对象在某一时刻的状态，这样以后就可以恢复到先前的状态；</li>
<li>用于获取状态的接口会暴露细节，需要将其隐藏起来。</li>
</ol>
<p>在本例中，我在cell的点击事件添加了删除绘本事件，用来删除被点击的书籍，具体代码如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(<span class="number">_</span> collectionView: UICollectionView, didSelectItemAt indexPath: IndexPath)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> alertVc = <span class="type">UIAlertController</span>(title: <span class="string">"要删除这本绘本么"</span>, message: <span class="string">""</span>, preferredStyle: .alert)</span><br><span class="line">    <span class="keyword">let</span> sureAction = <span class="type">UIAlertAction</span>(title: <span class="string">"确定删除"</span>, style: .<span class="keyword">default</span>, handler: &#123; (<span class="number">_</span>) <span class="keyword">in</span></span><br><span class="line">      <span class="type">BookAPI</span>.sharedInstance.deleteBookAt(index: indexPath.item) <span class="comment">// 发送删除绘本的请求</span></span><br><span class="line">      <span class="keyword">self</span>.books = <span class="type">BookAPI</span>.sharedInstance.getBooks() <span class="comment">// 更新数据源</span></span><br><span class="line">      <span class="keyword">self</span>.bookView?.deleteItems(at: [indexPath]) </span><br><span class="line">      <span class="type">BookAPI</span>.sharedInstance.saveBooks() <span class="comment">// 保存最新数据，到本地，下次加载app，删除绘本不再显示</span></span><br><span class="line">    &#125;)</span><br><span class="line">    alertVc.addAction(sureAction)</span><br><span class="line">    <span class="keyword">let</span> cancelAction = <span class="type">UIAlertAction</span>(title: <span class="string">"取消"</span>, style: .<span class="keyword">default</span>, handler: <span class="literal">nil</span>)</span><br><span class="line">    alertVc.addAction(cancelAction)</span><br><span class="line">    present(alertVc, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>内部的实现，封装在<code>PersistencyManager</code>对象中，真个思路就是，第一次启动加载budle中的资源(实际项目中需要加在服务器的数据)，然后保存到沙河中，但数据有更新变动时也实时保存数据，整个代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">let LibraryCacheDirectory = NSSearchPathForDirectoriesInDomains(.cachesDirectory, .userDomainMask, true).first!</span><br><span class="line"></span><br><span class="line">final class PersistencyManager: NSObject &#123;</span><br><span class="line">  </span><br><span class="line">  var books = [Book]()</span><br><span class="line">  </span><br><span class="line">  override init() &#123;</span><br><span class="line">    super.init()</span><br><span class="line">    </span><br><span class="line">    let fileName = &quot;\(LibraryCacheDirectory)/albums.bin&quot;</span><br><span class="line">    let fileurl = URL(fileURLWithPath: fileName)</span><br><span class="line">    let bookdata = try? Data(contentsOf: fileurl)</span><br><span class="line">    </span><br><span class="line">    guard let data = bookdata else &#123; // 本地沙河没有数据，所以需要加在bundle中的数据</span><br><span class="line">      setupBundleData()</span><br><span class="line">      return</span><br><span class="line">    &#125;</span><br><span class="line">    let json = try! JSONSerialization.jsonObject(with: data, options: .allowFragments) as? [Any]</span><br><span class="line">    for b in json! &#123;</span><br><span class="line">      let book = Book(fromDictionary: b as! [String : Any])</span><br><span class="line">      books.append(book)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  private func setupBundleData() &#123;</span><br><span class="line">    let path = Bundle.main.path(forResource: &quot;books&quot;, ofType: &quot;json&quot;)</span><br><span class="line">    let url = URL(fileURLWithPath: path!)</span><br><span class="line">    </span><br><span class="line">    do &#123;</span><br><span class="line">      let data = try Data(contentsOf: url)</span><br><span class="line">      let json = try JSONSerialization.jsonObject(with: data, options: .allowFragments) as? [Any]</span><br><span class="line">      print(data)</span><br><span class="line">      //      print(json)</span><br><span class="line">      for b in json! &#123;</span><br><span class="line">        //        print(b)</span><br><span class="line">        let book = Book(fromDictionary: b as! [String : Any])</span><br><span class="line">        books.append(book)</span><br><span class="line">      &#125;</span><br><span class="line">      print(books)</span><br><span class="line">      saveBooks()</span><br><span class="line">    &#125; catch &#123;</span><br><span class="line">      print(error)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  func getBooks() -&gt; [Book]&#123;</span><br><span class="line">    return books</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  func saveBooks() &#123;</span><br><span class="line">    let fileName = &quot;\(LibraryCacheDirectory)/albums.bin&quot;</span><br><span class="line">    let url = URL(fileURLWithPath: fileName)</span><br><span class="line">    let bookDicts = books.map &#123; (book) -&gt; [String:Any] in</span><br><span class="line">      book.toDictionary()</span><br><span class="line">    &#125;</span><br><span class="line">    let data = try? JSONSerialization.data(withJSONObject: bookDicts, options: .prettyPrinted)</span><br><span class="line">    try? data?.write(to: url)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  func deleteBookAt(index: Int) &#123;</span><br><span class="line">    if index &gt;= books.count &#123;</span><br><span class="line">      print(&quot;数组越界，没有此绘本书&quot;)</span><br><span class="line">      return</span><br><span class="line">    &#125;</span><br><span class="line">    books.remove(at: index)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>感兴趣的可以在github上下载<a href="https://github.com/XcqRomance/BookRoom-complete-.git" target="_blank" rel="noopener">完整代码</a>大家相互交流，整个项目只是我从实际项目中摘取出来的一个页面来讲解，而整个iOS设计模式的内容肯定址这么点内容，后续有时间我应该会更新代码讲解其他的设计模式。<br>我的参考内容有：</p>
<ol>
<li>图灵程序设计丛书<a href="https://github.com/XcqRomance/BookRoom-complete-/blob/master/IOS%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E8%A7%A3%E6%9E%90.pdf" target="_blank" rel="noopener">Objective-C编程之道 iOS设计模式解析</a></li>
<li>raywenderlich官网文章<a href="https://www.raywenderlich.com/46988/ios-design-patterns" target="_blank" rel="noopener">iOS Design Patterns</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/romance.jpg"
                alt="Romance" />
            
              <p class="site-author-name" itemprop="name">Romance</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">26</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/XcqRomance" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.jianshu.com/u/d1414d91084a" target="_blank" title="简书">
                      
                        <i class="fa fa-fw fa-globe"></i>简书</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Romance</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://XcqRomance.disqus.com/count.js" async></script>
    

    

  




	





  














  





  

  

  

  
  

  

  

  

</body>
</html>
